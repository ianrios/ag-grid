/**
          * @ag-grid-community/infinite-row-model - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v31.0.0
          * @link https://www.ag-grid.com/
          * @license MIT
          */
/**
          * @ag-grid-community/infinite-row-model - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v31.0.0
          * @link https://www.ag-grid.com/
          * @license MIT
          */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t,e=require("@ag-grid-community/core"),o=(t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)},function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}),r=function(t,e,o,r){var n,i=arguments.length,s=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(i<3?n(s):i>3?n(e,o,s):n(e,o))||s);return i>3&&s&&Object.defineProperty(e,o,s),s},n=function(t){function n(e,o,r){var n=t.call(this,e)||this;return n.parentCache=o,n.params=r,n.startRow=e*r.blockSize,n.endRow=n.startRow+r.blockSize,n}return o(n,t),n.prototype.postConstruct=function(){this.createRowNodes()},n.prototype.getBlockStateJson=function(){return{id:""+this.getId(),state:{blockNumber:this.getId(),startRow:this.getStartRow(),endRow:this.getEndRow(),pageStatus:this.getState()}}},n.prototype.setDataAndId=function(t,o,r){e._.exists(o)?t.setDataAndId(o,r.toString()):t.setDataAndId(void 0,void 0)},n.prototype.loadFromDatasource=function(){var t=this,o=this.createLoadParams();e._.missing(this.params.datasource.getRows)?console.warn("AG Grid: datasource is missing getRows method"):window.setTimeout((function(){t.params.datasource.getRows(o)}),0)},n.prototype.processServerFail=function(){},n.prototype.createLoadParams=function(){return{startRow:this.getStartRow(),endRow:this.getEndRow(),successCallback:this.pageLoaded.bind(this,this.getVersion()),failCallback:this.pageLoadFailed.bind(this,this.getVersion()),sortModel:this.params.sortModel,filterModel:this.params.filterModel,context:this.gridOptionsService.context}},n.prototype.forEachNode=function(t,e,o){var r=this;this.rowNodes.forEach((function(n,i){r.startRow+i<o&&t(n,e.next())}))},n.prototype.getLastAccessed=function(){return this.lastAccessed},n.prototype.getRow=function(t,e){void 0===e&&(e=!1),e||(this.lastAccessed=this.params.lastAccessedSequence.next());var o=t-this.startRow;return this.rowNodes[o]},n.prototype.getStartRow=function(){return this.startRow},n.prototype.getEndRow=function(){return this.endRow},n.prototype.createRowNodes=function(){this.rowNodes=[];for(var t=0;t<this.params.blockSize;t++){var o=this.startRow+t,r=new e.RowNode(this.beans);r.setRowHeight(this.params.rowHeight),r.uiLevel=0,r.setRowIndex(o),r.setRowTop(this.params.rowHeight*o),this.rowNodes.push(r)}},n.prototype.processServerResult=function(t){var o=this;this.rowNodes.forEach((function(r,n){var i=t.rowData?t.rowData[n]:void 0;!r.id&&r.alreadyRendered&&i&&(o.rowNodes[n]=new e.RowNode(o.beans),o.rowNodes[n].setRowIndex(r.rowIndex),o.rowNodes[n].setRowTop(r.rowTop),o.rowNodes[n].setRowHeight(r.rowHeight),r.clearRowTopAndRowIndex()),o.setDataAndId(o.rowNodes[n],i,o.startRow+n)}));var r=null!=t.rowCount&&t.rowCount>=0?t.rowCount:void 0;this.parentCache.pageLoaded(this,r)},n.prototype.destroyRowNodes=function(){this.rowNodes.forEach((function(t){t.clearRowTopAndRowIndex()}))},r([e.Autowired("beans")],n.prototype,"beans",void 0),r([e.PostConstruct],n.prototype,"postConstruct",null),r([e.PreDestroy],n.prototype,"destroyRowNodes",null),n}(e.RowNodeBlock),i=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),s=function(t,e,o,r){var n,i=arguments.length,s=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(i<3?n(s):i>3?n(e,o,s):n(e,o))||s);return i>3&&s&&Object.defineProperty(e,o,s),s},a=function(t,e){return function(o,r){e(o,r,t)}},c=function(t){function o(e){var o=t.call(this)||this;return o.lastRowIndexKnown=!1,o.blocks={},o.blockCount=0,o.rowCount=e.initialRowCount,o.params=e,o}return i(o,t),o.prototype.setBeans=function(t){this.logger=t.create("InfiniteCache")},o.prototype.getRow=function(t,e){void 0===e&&(e=!1);var o=Math.floor(t/this.params.blockSize),r=this.blocks[o];if(!r){if(e)return;r=this.createBlock(o)}return r.getRow(t)},o.prototype.createBlock=function(t){var e=this.createBean(new n(t,this,this.params));return this.blocks[e.getId()]=e,this.blockCount++,this.purgeBlocksIfNeeded(e),this.params.rowNodeBlockLoader.addBlock(e),e},o.prototype.refreshCache=function(){0==this.blockCount?this.purgeCache():(this.getBlocksInOrder().forEach((function(t){return t.setStateWaitingToLoad()})),this.params.rowNodeBlockLoader.checkBlockToLoad())},o.prototype.destroyAllBlocks=function(){var t=this;this.getBlocksInOrder().forEach((function(e){return t.destroyBlock(e)}))},o.prototype.getRowCount=function(){return this.rowCount},o.prototype.isLastRowIndexKnown=function(){return this.lastRowIndexKnown},o.prototype.pageLoaded=function(t,e){this.isAlive()&&(this.logger.log("onPageLoaded: page = ".concat(t.getId(),", lastRow = ").concat(e)),this.checkRowCount(t,e),this.onCacheUpdated())},o.prototype.purgeBlocksIfNeeded=function(t){var e=this,r=this.getBlocksInOrder().filter((function(e){return e!=t}));r.sort((function(t,e){return e.getLastAccessed()-t.getLastAccessed()}));var i=this.params.maxBlocksInCache>0,s=i?this.params.maxBlocksInCache-1:null,a=o.MAX_EMPTY_BLOCKS_TO_KEEP-1;r.forEach((function(t,o){if(t.getState()===n.STATE_WAITING_TO_LOAD&&o>=a||!!i&&o>=s){if(e.isBlockCurrentlyDisplayed(t))return;if(e.isBlockFocused(t))return;e.removeBlockFromCache(t)}}))},o.prototype.isBlockFocused=function(t){var e=this.focusService.getFocusCellToUseAfterRefresh();if(!e)return!1;if(null!=e.rowPinned)return!1;var o=t.getStartRow(),r=t.getEndRow();return e.rowIndex>=o&&e.rowIndex<r},o.prototype.isBlockCurrentlyDisplayed=function(t){var e=t.getStartRow(),o=t.getEndRow()-1;return this.rowRenderer.isRangeInRenderedViewport(e,o)},o.prototype.removeBlockFromCache=function(t){t&&this.destroyBlock(t)},o.prototype.checkRowCount=function(t,e){if("number"==typeof e&&e>=0)this.rowCount=e,this.lastRowIndexKnown=!0;else if(!this.lastRowIndexKnown){var o=(t.getId()+1)*this.params.blockSize+this.params.overflowSize;this.rowCount<o&&(this.rowCount=o)}},o.prototype.setRowCount=function(t,o){this.rowCount=t,e._.exists(o)&&(this.lastRowIndexKnown=o),this.lastRowIndexKnown||this.rowCount%this.params.blockSize==0&&this.rowCount++,this.onCacheUpdated()},o.prototype.forEachNodeDeep=function(t){var o=this,r=new e.NumberSequence;this.getBlocksInOrder().forEach((function(e){return e.forEachNode(t,r,o.rowCount)}))},o.prototype.getBlocksInOrder=function(){return e._.getAllValuesInObject(this.blocks).sort((function(t,e){return t.getId()-e.getId()}))},o.prototype.destroyBlock=function(t){delete this.blocks[t.getId()],this.destroyBean(t),this.blockCount--,this.params.rowNodeBlockLoader.removeBlock(t)},o.prototype.onCacheUpdated=function(){if(this.isAlive()){this.destroyAllBlocksPastVirtualRowCount();var t={type:e.Events.EVENT_STORE_UPDATED};this.eventService.dispatchEvent(t)}},o.prototype.destroyAllBlocksPastVirtualRowCount=function(){var t=this,e=[];this.getBlocksInOrder().forEach((function(o){o.getId()*t.params.blockSize>=t.rowCount&&e.push(o)})),e.length>0&&e.forEach((function(e){return t.destroyBlock(e)}))},o.prototype.purgeCache=function(){var t=this;this.getBlocksInOrder().forEach((function(e){return t.removeBlockFromCache(e)})),this.lastRowIndexKnown=!1,0===this.rowCount&&(this.rowCount=this.params.initialRowCount),this.onCacheUpdated()},o.prototype.getRowNodesInRange=function(t,o){var r=this,n=[],i=-1,s=!1,a=new e.NumberSequence;e._.missing(t)&&(s=!0);var c=!1;return this.getBlocksInOrder().forEach((function(e){c||(s&&i+1!==e.getId()?c=!0:(i=e.getId(),e.forEachNode((function(e){var r=e===t||e===o;(s||r)&&n.push(e),r&&(s=!s)}),a,r.rowCount)))})),c||s?[]:n},o.MAX_EMPTY_BLOCKS_TO_KEEP=2,s([e.Autowired("rowRenderer")],o.prototype,"rowRenderer",void 0),s([e.Autowired("focusService")],o.prototype,"focusService",void 0),s([a(0,e.Qualifier("loggerFactory"))],o.prototype,"setBeans",null),s([e.PreDestroy],o.prototype,"destroyAllBlocks",null),o}(e.BeanStub),h=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),u=function(t,e,o,r){var n,i=arguments.length,s=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(i<3?n(s):i>3?n(e,o,s):n(e,o))||s);return i>3&&s&&Object.defineProperty(e,o,s),s},d=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return h(o,t),o.prototype.getRowBounds=function(t){return{rowHeight:this.rowHeight,rowTop:this.rowHeight*t}},o.prototype.ensureRowHeightsValid=function(t,e,o,r){return!1},o.prototype.init=function(){var t=this;this.gridOptionsService.isRowModelType("infinite")&&(this.rowHeight=this.gridOptionsService.getRowHeightAsNumber(),this.addEventListeners(),this.addDestroyFunc((function(){return t.destroyCache()})),this.verifyProps())},o.prototype.verifyProps=function(){this.gridOptionsService.exists("initialGroupOrderComparator")&&e._.warnOnce("initialGroupOrderComparator cannot be used with Infinite Row Model as sorting is done on the server side")},o.prototype.start=function(){this.setDatasource(this.gridOptionsService.get("datasource"))},o.prototype.destroyDatasource=function(){this.datasource&&(this.getContext().destroyBean(this.datasource),this.rowRenderer.datasourceChanged(),this.datasource=null)},o.prototype.addEventListeners=function(){var t=this;this.addManagedListener(this.eventService,e.Events.EVENT_FILTER_CHANGED,this.onFilterChanged.bind(this)),this.addManagedListener(this.eventService,e.Events.EVENT_SORT_CHANGED,this.onSortChanged.bind(this)),this.addManagedListener(this.eventService,e.Events.EVENT_NEW_COLUMNS_LOADED,this.onColumnEverything.bind(this)),this.addManagedListener(this.eventService,e.Events.EVENT_STORE_UPDATED,this.onCacheUpdated.bind(this)),this.addManagedPropertyListener("datasource",(function(){return t.setDatasource(t.gridOptionsService.get("datasource"))})),this.addManagedPropertyListener("cacheBlockSize",(function(){return t.resetCache()})),this.addManagedPropertyListener("rowHeight",(function(){t.rowHeight=t.gridOptionsService.getRowHeightAsNumber(),t.cacheParams.rowHeight=t.rowHeight,t.updateRowHeights()}))},o.prototype.onFilterChanged=function(){this.reset()},o.prototype.onSortChanged=function(){this.reset()},o.prototype.onColumnEverything=function(){(!this.cacheParams||this.isSortModelDifferent())&&this.reset()},o.prototype.isSortModelDifferent=function(){return!e._.jsonEquals(this.cacheParams.sortModel,this.sortController.getSortModel())},o.prototype.getType=function(){return"infinite"},o.prototype.setDatasource=function(t){this.destroyDatasource(),this.datasource=t,t&&this.reset()},o.prototype.isEmpty=function(){return!this.infiniteCache},o.prototype.isRowsToRender=function(){return!!this.infiniteCache},o.prototype.getNodesInRangeForSelection=function(t,e){return this.infiniteCache?this.infiniteCache.getRowNodesInRange(t,e):[]},o.prototype.reset=function(){this.datasource&&(null!=this.gridOptionsService.getCallback("getRowId")||this.selectionService.reset("rowDataChanged"),this.resetCache())},o.prototype.createModelUpdatedEvent=function(){return{type:e.Events.EVENT_MODEL_UPDATED,newPage:!1,newPageSize:!1,newData:!1,keepRenderedRows:!0,animate:!1}},o.prototype.resetCache=function(){this.destroyCache(),this.cacheParams={datasource:this.datasource,filterModel:this.filterManager.getFilterModel(),sortModel:this.sortController.getSortModel(),rowNodeBlockLoader:this.rowNodeBlockLoader,initialRowCount:this.gridOptionsService.get("infiniteInitialRowCount"),maxBlocksInCache:this.gridOptionsService.get("maxBlocksInCache"),rowHeight:this.gridOptionsService.getRowHeightAsNumber(),overflowSize:this.gridOptionsService.get("cacheOverflowSize"),blockSize:this.gridOptionsService.get("cacheBlockSize"),lastAccessedSequence:new e.NumberSequence},this.infiniteCache=this.createBean(new c(this.cacheParams)),this.eventService.dispatchEventOnce({type:e.Events.EVENT_ROW_COUNT_READY});var t=this.createModelUpdatedEvent();this.eventService.dispatchEvent(t)},o.prototype.updateRowHeights=function(){var t=this;this.forEachNode((function(e){e.setRowHeight(t.rowHeight),e.setRowTop(t.rowHeight*e.rowIndex)}));var e=this.createModelUpdatedEvent();this.eventService.dispatchEvent(e)},o.prototype.destroyCache=function(){this.infiniteCache&&(this.infiniteCache=this.destroyBean(this.infiniteCache))},o.prototype.onCacheUpdated=function(){var t=this.createModelUpdatedEvent();this.eventService.dispatchEvent(t)},o.prototype.getRow=function(t){if(this.infiniteCache&&!(t>=this.infiniteCache.getRowCount()))return this.infiniteCache.getRow(t)},o.prototype.getRowNode=function(t){var e;return this.forEachNode((function(o){o.id===t&&(e=o)})),e},o.prototype.forEachNode=function(t){this.infiniteCache&&this.infiniteCache.forEachNodeDeep(t)},o.prototype.getTopLevelRowCount=function(){return this.getRowCount()},o.prototype.getTopLevelRowDisplayedIndex=function(t){return t},o.prototype.getRowIndexAtPixel=function(t){if(0!==this.rowHeight){var e=Math.floor(t/this.rowHeight),o=this.getRowCount()-1;return e>o?o:e}return 0},o.prototype.getRowCount=function(){return this.infiniteCache?this.infiniteCache.getRowCount():0},o.prototype.isRowPresent=function(t){return!!this.getRowNode(t.id)},o.prototype.refreshCache=function(){this.infiniteCache&&this.infiniteCache.refreshCache()},o.prototype.purgeCache=function(){this.infiniteCache&&this.infiniteCache.purgeCache()},o.prototype.isLastRowIndexKnown=function(){return!!this.infiniteCache&&this.infiniteCache.isLastRowIndexKnown()},o.prototype.setRowCount=function(t,e){this.infiniteCache&&this.infiniteCache.setRowCount(t,e)},u([e.Autowired("filterManager")],o.prototype,"filterManager",void 0),u([e.Autowired("sortController")],o.prototype,"sortController",void 0),u([e.Autowired("selectionService")],o.prototype,"selectionService",void 0),u([e.Autowired("rowRenderer")],o.prototype,"rowRenderer",void 0),u([e.Autowired("rowNodeBlockLoader")],o.prototype,"rowNodeBlockLoader",void 0),u([e.PostConstruct],o.prototype,"init",null),u([e.PreDestroy],o.prototype,"destroyDatasource",null),o=u([e.Bean("rowModel")],o)}(e.BeanStub),p={version:"31.0.0",moduleName:e.ModuleNames.InfiniteRowModelModule,rowModel:"infinite",beans:[d]};exports.InfiniteRowModelModule=p;