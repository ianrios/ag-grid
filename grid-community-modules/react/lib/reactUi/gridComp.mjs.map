{"version":3,"sources":["reactUi/gridComp.tsx"],"names":[],"mappings":"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","file":"gridComp.mjs","sourcesContent":["import {\n    Beans, Context,\n    FocusService,\n    GridCtrl,\n    IGridComp\n} from '@ag-grid-community/core';\nimport React, { memo, useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { BeansContext } from './beansContext';\nimport GridBodyComp from './gridBodyComp';\nimport useReactCommentEffect from './reactComment';\nimport TabGuardComp, { TabGuardCompCallback } from './tabGuardComp';\nimport { classesList } from './utils';\n\ninterface GridCompProps {\n    context: Context;\n}\n\nconst GridComp = ({ context }: GridCompProps) => {\n\n    const [rtlClass, setRtlClass] = useState<string>('');\n    const [keyboardFocusClass, setKeyboardFocusClass] = useState<string>('');\n    const [layoutClass, setLayoutClass] = useState<string>('');\n    const [cursor, setCursor] = useState<string | null>(null);\n    const [userSelect, setUserSelect] = useState<string | null>(null);\n    const [initialised, setInitialised] = useState<boolean>(false);\n    const [tabGuardReady, setTabGuardReady] = useState<any>();\n\n    const gridCtrlRef = useRef<GridCtrl | null>(null);\n    const eRootWrapperRef = useRef<HTMLDivElement | null>(null);\n    const tabGuardRef = useRef<TabGuardCompCallback>();\n    // eGridBodyParent is state as we use it in render\n    const [eGridBodyParent,setGridBodyParent] = useState<HTMLDivElement | null>(null);\n\n    const focusInnerElementRef = useRef<((fromBottom?: boolean) => void)>(() => undefined);\n\n    const onTabKeyDown = useCallback(() => undefined, []);\n\n    const beans = useMemo(() => {\n        if (context.isDestroyed()) { return null; }\n        return context.getBean('beans') as Beans;\n    }, [context]);\n\n    useReactCommentEffect(' AG Grid ', eRootWrapperRef);\n\n    const setRef = useCallback((e: HTMLDivElement) => {\n        eRootWrapperRef.current = e;\n\n        if (!eRootWrapperRef.current) {\n            context.destroyBean(gridCtrlRef.current);\n            gridCtrlRef.current = null;\n            return;\n        }\n\n        if (context.isDestroyed()) {\n            return;\n        }\n\n        gridCtrlRef.current = context.createBean(new GridCtrl());\n        const gridCtrl = gridCtrlRef.current;\n\n        focusInnerElementRef.current = gridCtrl.focusInnerElement.bind(gridCtrl);\n\n        const compProxy: IGridComp = {\n            destroyGridUi:\n                () => {}, // do nothing, as framework users destroy grid by removing the comp\n            setRtlClass: setRtlClass,\n            forceFocusOutOfContainer: () => {\n                tabGuardRef.current?.forceFocusOutOfContainer();\n            },\n            updateLayoutClasses: setLayoutClass,\n            getFocusableContainers: () => {\n                const els: HTMLElement[] = [];\n\n                const gridBodyCompEl = eRootWrapperRef.current?.querySelector('.ag-root');\n                const sideBarEl = eRootWrapperRef.current?.querySelector('.ag-side-bar:not(.ag-hidden)');\n\n                if (gridBodyCompEl) {\n                    els.push(gridBodyCompEl as HTMLElement);\n                }\n\n                if (sideBarEl) {\n                    els.push(sideBarEl as HTMLElement);\n                }\n\n                return els;\n            },\n            setCursor,\n            setUserSelect\n        };\n\n        gridCtrl.setComp(compProxy, eRootWrapperRef.current, eRootWrapperRef.current);\n\n        setInitialised(true);\n\n    }, []);\n\n    // initialise the extra components\n    useEffect(() => {\n        if (!tabGuardReady || !beans || !gridCtrlRef.current || !eGridBodyParent || !eRootWrapperRef.current) { return; }\n\n        const gridCtrl = gridCtrlRef.current;\n        const beansToDestroy: any[] = [];\n        const {agStackComponentsRegistry} = beans;\n\n        const HeaderDropZonesClass = agStackComponentsRegistry.getComponentClass('AG-GRID-HEADER-DROP-ZONES');\n        const SideBarClass = agStackComponentsRegistry.getComponentClass('AG-SIDE-BAR');\n        const StatusBarClass = agStackComponentsRegistry.getComponentClass('AG-STATUS-BAR');\n        const WatermarkClass = agStackComponentsRegistry.getComponentClass('AG-WATERMARK');\n        const PaginationClass = agStackComponentsRegistry.getComponentClass('AG-PAGINATION');\n        const additionalEls: HTMLDivElement[] = [];\n        const eRootWrapper = eRootWrapperRef.current;\n\n        if (gridCtrl.showDropZones() && HeaderDropZonesClass) {\n            const headerDropZonesComp = context.createBean(new HeaderDropZonesClass());\n            const eGui = headerDropZonesComp.getGui();\n            eRootWrapper.insertAdjacentElement('afterbegin', eGui);\n            additionalEls.push(eGui);\n            beansToDestroy.push(headerDropZonesComp);\n        }\n\n        if (gridCtrl.showSideBar() && SideBarClass) {\n            const sideBarComp = context.createBean(new SideBarClass());\n            const eGui = sideBarComp.getGui();\n            const bottomTabGuard = eGridBodyParent.querySelector('.ag-tab-guard-bottom');\n            if (bottomTabGuard) {\n                bottomTabGuard.insertAdjacentElement('beforebegin', eGui);\n                additionalEls.push(eGui);\n            }\n\n            beansToDestroy.push(sideBarComp);\n        }\n\n        if (gridCtrl.showStatusBar() && StatusBarClass) {\n            const statusBarComp = context.createBean(new StatusBarClass());\n            const eGui = statusBarComp.getGui();\n            eRootWrapper.insertAdjacentElement('beforeend', eGui);\n            additionalEls.push(eGui);\n            beansToDestroy.push(statusBarComp);\n        }\n\n        if (PaginationClass) {\n            const paginationComp = context.createBean(new PaginationClass());\n            const eGui = paginationComp.getGui();\n            eRootWrapper.insertAdjacentElement('beforeend', eGui);\n            additionalEls.push(eGui);\n            beansToDestroy.push(paginationComp);\n        }\n\n        if (gridCtrl.showWatermark() && WatermarkClass) {\n            const watermarkComp = context.createBean(new WatermarkClass());\n            const eGui = watermarkComp.getGui();\n            eRootWrapper.insertAdjacentElement('beforeend', eGui);\n            additionalEls.push(eGui);\n            beansToDestroy.push(watermarkComp);\n        }\n\n        return () => {\n            context.destroyBeans(beansToDestroy);\n            additionalEls.forEach(el => {\n                if (el.parentElement) {\n                    el.parentElement.removeChild(el);\n                }\n            });\n        }\n    }, [tabGuardReady, eGridBodyParent, beans])\n\n    const rootWrapperClasses = useMemo(()=> classesList('ag-root-wrapper', rtlClass, keyboardFocusClass, layoutClass), [rtlClass, keyboardFocusClass, layoutClass]);\n    const rootWrapperBodyClasses = useMemo(() => classesList('ag-root-wrapper-body', 'ag-focus-managed', layoutClass), [layoutClass]);\n\n    const topStyle: React.CSSProperties = useMemo(() => ({\n        userSelect: userSelect != null ? (userSelect as any) : '',\n        WebkitUserSelect: userSelect != null ? (userSelect as any) : '',\n        cursor: cursor != null ? cursor : ''\n    }), [userSelect, cursor]);\n\n\n    const setTabGuardCompRef = useCallback((ref: TabGuardCompCallback) => {\n        tabGuardRef.current = ref;\n        setTabGuardReady(ref !== null);\n    }, []);\n    \n    return (\n        <div ref={setRef} className={rootWrapperClasses} style={topStyle} role=\"presentation\">\n            <div className={ rootWrapperBodyClasses } ref={ setGridBodyParent } role=\"presentation\">\n                {initialised && eGridBodyParent && beans &&\n                    <BeansContext.Provider value={beans}>\n                        <TabGuardComp\n                            ref={ setTabGuardCompRef }\n                            eFocusableElement= { eGridBodyParent }\n                            onTabKeyDown={ onTabKeyDown }\n                            gridCtrl={ gridCtrlRef.current! }>\n                        { // we wait for initialised before rending the children, so GridComp has created and registered with it's\n                        // GridCtrl before we create the child GridBodyComp. Otherwise the GridBodyComp would initialise first,\n                        // before we have set the the Layout CSS classes, causing the GridBodyComp to render rows to a grid that\n                        // doesn't have it's height specified, which would result if all the rows getting rendered (and if many rows,\n                        // hangs the UI)\n                            <GridBodyComp/>\n                        }\n                        </TabGuardComp>\n                    </BeansContext.Provider>\n                }\n            </div>\n        </div>\n    );\n};\n\nexport default memo(GridComp);\n"]}