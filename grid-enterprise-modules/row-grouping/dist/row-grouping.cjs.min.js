/**
          * @ag-grid-enterprise/row-grouping - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v31.0.0
          * @link https://www.ag-grid.com/
          * @license Commercial
          */
/**
          * @ag-grid-enterprise/row-grouping - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v31.0.0
          * @link https://www.ag-grid.com/
          * @license Commercial
          */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("@ag-grid-community/core"),o=require("@ag-grid-enterprise/core"),n=(e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)},function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}),r=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},i=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return n(o,e),o.prototype.execute=function(e){var o=t._.missingOrEmpty(this.columnModel.getValueColumns()),n=!this.gridOptionsService.getCallback("getGroupRowAgg"),r=e.changedPath&&e.changedPath.isActive();if(!(o&&n&&r)){var i=this.createAggDetails(e);this.recursivelyCreateAggData(i)}},o.prototype.createAggDetails=function(e){var t=this.columnModel.isPivotActive(),o=this.columnModel.getValueColumns(),n=t?this.columnModel.getPivotColumns():[];return{alwaysAggregateAtRootLevel:this.gridOptionsService.get("alwaysAggregateAtRootLevel"),groupIncludeTotalFooter:this.gridOptionsService.get("groupIncludeTotalFooter"),changedPath:e.changedPath,valueColumns:o,pivotColumns:n,filteredOnly:!this.isSuppressAggFilteredOnly(),userAggFunc:this.gridOptionsService.getCallback("getGroupRowAgg")}},o.prototype.isSuppressAggFilteredOnly=function(){return void 0!==this.gridOptionsService.getGroupAggFiltering()||this.gridOptionsService.get("suppressAggFilteredOnly")},o.prototype.recursivelyCreateAggData=function(e){var t=this;e.changedPath.forEachChangedNodeDepthFirst((function(o){if(!o.hasChildren())o.aggData&&o.setAggData(null);else{if(-1===o.level&&!e.groupIncludeTotalFooter){var n=!t.columnModel.isPivotMode();if(!e.alwaysAggregateAtRootLevel&&n)return void o.setAggData(null)}t.aggregateRowNode(o,e)}}),!0)},o.prototype.aggregateRowNode=function(e,t){var o,n=0===t.valueColumns.length,r=0===t.pivotColumns.length;o=t.userAggFunc?t.userAggFunc({nodes:e.childrenAfterFilter}):n?null:r?this.aggregateRowNodeUsingValuesOnly(e,t):this.aggregateRowNodeUsingValuesAndPivot(e),e.setAggData(o),e.sibling&&e.sibling.setAggData(o)},o.prototype.aggregateRowNodeUsingValuesAndPivot=function(e){var o,n=this,r={},i=null!==(o=this.columnModel.getSecondaryColumns())&&void 0!==o?o:[];return i.forEach((function(o){var i=o.getColDef(),a=i.pivotValueColumn,l=i.pivotTotalColumnIds,s=i.colId,u=i.pivotKeys;if(!t._.exists(l)){var p,c=null!=u?u:[];p=e.leafGroup?n.getValuesFromMappedSet(e.childrenMapped,c,a):n.getValuesPivotNonLeaf(e,s),r[s]=n.aggregateValues(p,a.getAggFunc(),a,e,o)}})),i.forEach((function(o){var i=o.getColDef(),a=i.pivotValueColumn,l=i.pivotTotalColumnIds,s=i.colId;if(t._.exists(l)){var u=[];l&&l.length&&(l.forEach((function(e){u.push(r[e])})),r[s]=n.aggregateValues(u,a.getAggFunc(),a,e,o))}})),r},o.prototype.aggregateRowNodeUsingValuesOnly=function(e,t){var o=this,n={},r=t.changedPath.isActive()?t.changedPath.getValueColumnsForNode(e,t.valueColumns):t.valueColumns,i=t.changedPath.isActive()?t.changedPath.getNotValueColumnsForNode(e,t.valueColumns):null,a=this.getValuesNormal(e,r,t.filteredOnly),l=e.aggData;return r.forEach((function(t,r){n[t.getId()]=o.aggregateValues(a[r],t.getAggFunc(),t,e)})),i&&l&&i.forEach((function(e){n[e.getId()]=l[e.getId()]})),n},o.prototype.getValuesPivotNonLeaf=function(e,t){var o=[];return e.childrenAfterFilter.forEach((function(e){var n=e.aggData[t];o.push(n)})),o},o.prototype.getValuesFromMappedSet=function(e,t,o){var n=this,r=e;if(t.forEach((function(e){return r=r?r[e]:null})),!r)return[];var i=[];return r.forEach((function(e){var t=n.valueService.getValue(o,e);i.push(t)})),i},o.prototype.getValuesNormal=function(e,t,o){var n=[];t.forEach((function(){return n.push([])}));for(var r=t.length,i=o?e.childrenAfterFilter:e.childrenAfterGroup,a=i.length,l=0;l<a;l++)for(var s=i[l],u=0;u<r;u++){var p=t[u],c=this.valueService.getValue(p,s);n[u].push(c)}return n},o.prototype.aggregateValues=function(e,t,o,n,r){var i="string"==typeof t?this.aggFuncService.getAggFunc(t):t;return"function"!=typeof i?(console.error("AG Grid: unrecognised aggregation function ".concat(t)),null):i({values:e,column:o,colDef:o?o.getColDef():void 0,pivotResultColumn:r,rowNode:n,data:n?n.data:void 0,api:this.gridOptionsService.api,columnApi:this.gridOptionsService.columnApi,context:this.gridOptionsService.context})},r([t.Autowired("columnModel")],o.prototype,"columnModel",void 0),r([t.Autowired("valueService")],o.prototype,"valueService",void 0),r([t.Autowired("aggFuncService")],o.prototype,"aggFuncService",void 0),o=r([t.Bean("aggregationStage")],o)}(t.BeanStub),a=function(){function e(){this.allSets={},this.allParents=[]}return e.prototype.removeFromChildrenAfterGroup=function(e,t){this.getSet(e).removeFromChildrenAfterGroup[t.id]=!0},e.prototype.isRemoveFromAllLeafChildren=function(e,t){return!!this.getSet(e).removeFromAllLeafChildren[t.id]},e.prototype.preventRemoveFromAllLeafChildren=function(e,t){delete this.getSet(e).removeFromAllLeafChildren[t.id]},e.prototype.removeFromAllLeafChildren=function(e,t){this.getSet(e).removeFromAllLeafChildren[t.id]=!0},e.prototype.getSet=function(e){return this.allSets[e.id]||(this.allSets[e.id]={removeFromAllLeafChildren:{},removeFromChildrenAfterGroup:{}},this.allParents.push(e)),this.allSets[e.id]},e.prototype.getAllParents=function(){return this.allParents},e.prototype.flush=function(){var e=this;this.allParents.forEach((function(t){var o=e.allSets[t.id];t.childrenAfterGroup=t.childrenAfterGroup.filter((function(e){return!o.removeFromChildrenAfterGroup[e.id]})),t.allLeafChildren=t.allLeafChildren.filter((function(e){return!o.removeFromAllLeafChildren[e.id]})),t.updateHasChildren(),t.sibling&&(t.sibling.childrenAfterGroup=t.childrenAfterGroup,t.sibling.allLeafChildren=t.allLeafChildren)})),this.allSets={},this.allParents.length=0},e}(),l=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),s=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},u=function(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var n,r,i=o.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},p=function(e,t,o){if(o||2===arguments.length)for(var n,r=0,i=t.length;r<i;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))},c=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return l(o,e),o.prototype.execute=function(e){var t=this.createGroupingDetails(e);if(t.transactions)this.handleTransaction(t);else{var o=!0===e.afterColumnsChanged;this.shotgunResetEverything(t,o)}t.usingTreeData||(this.positionLeafsAndGroups(e.changedPath),this.orderGroups(t)),this.selectableService.updateSelectableAfterGrouping()},o.prototype.positionLeafsAndGroups=function(e){e.forEachChangedNodeDepthFirst((function(e){if(e.childrenAfterGroup){var t,o=[],n=[];e.childrenAfterGroup.forEach((function(e){var r;(null===(r=e.childrenAfterGroup)||void 0===r?void 0:r.length)?""!==e.key||t?n.push(e):t=e:o.push(e)})),t&&n.push(t),e.childrenAfterGroup=p(p([],u(o),!1),u(n),!1)}}),!1)},o.prototype.createGroupingDetails=function(e){var t,o=e.rowNode,n=e.changedPath,r=e.rowNodeTransactions,i=e.rowNodeOrder,a=this.gridOptionsService.get("treeData"),l=a?null:this.columnModel.getRowGroupColumns();return{includeParents:!this.gridOptionsService.get("suppressParentsInRowNodes"),expandByDefault:this.gridOptionsService.get("groupDefaultExpanded"),groupedCols:l,rootNode:o,pivotMode:this.columnModel.isPivotMode(),groupedColCount:a||!l?0:l.length,rowNodeOrder:i,transactions:r,changedPath:n,groupAllowUnbalanced:this.gridOptionsService.get("groupAllowUnbalanced"),isGroupOpenByDefault:this.gridOptionsService.getCallback("isGroupOpenByDefault"),initialGroupOrderComparator:this.gridOptionsService.getCallback("initialGroupOrderComparator"),usingTreeData:a,suppressGroupMaintainValueType:this.gridOptionsService.get("suppressGroupMaintainValueType"),getDataPath:a?this.gridOptionsService.get("getDataPath"):void 0,keyCreators:null!==(t=null==l?void 0:l.map((function(e){return e.getColDef().keyCreator})))&&void 0!==t?t:[]}},o.prototype.handleTransaction=function(e){var o=this;e.transactions.forEach((function(n){var r=e.usingTreeData?void 0:new a;if(t._.existsAndNotEmpty(n.remove)&&o.removeNodes(n.remove,e,r),t._.existsAndNotEmpty(n.update)&&o.moveNodesInWrongPath(n.update,e,r),t._.existsAndNotEmpty(n.add)&&o.insertNodes(n.add,e,!1),r){var i=r.getAllParents().slice();r.flush(),o.removeEmptyGroups(i,e)}})),e.rowNodeOrder&&this.sortChildren(e)},o.prototype.sortChildren=function(e){e.changedPath.forEachChangedNodeDepthFirst((function(o){o.childrenAfterGroup&&(t._.sortRowNodesByOrder(o.childrenAfterGroup,e.rowNodeOrder)&&e.changedPath.addParentNode(o))}),!1,!0)},o.prototype.orderGroups=function(e){var o=e.initialGroupOrderComparator;t._.exists(o)&&function e(n){t._.exists(n.childrenAfterGroup)&&!n.leafGroup&&(n.childrenAfterGroup.sort((function(e,t){return o({nodeA:e,nodeB:t})})),n.childrenAfterGroup.forEach((function(t){return e(t)})))}(e.rootNode)},o.prototype.getExistingPathForNode=function(e,t){for(var o=[],n=t.usingTreeData?e:e.parent;n&&n!==t.rootNode;)o.push({key:n.key,rowGroupColumn:n.rowGroupColumn,field:n.field}),n=n.parent;return o.reverse(),o},o.prototype.moveNodesInWrongPath=function(e,o,n){var r=this;e.forEach((function(e){o.changedPath.isActive()&&o.changedPath.addParentNode(e.parent);var i=function(e){return e.key},a=r.getExistingPathForNode(e,o).map(i),l=r.getGroupInfo(e,o).map(i);t._.areEqual(a,l)||r.moveNode(e,o,n)}))},o.prototype.moveNode=function(e,t,o){if(this.removeNodesInStages([e],t,o),this.insertOneNode(e,t,!0,o),e.setData(e.data),t.changedPath.isActive()){var n=e.parent;t.changedPath.addParentNode(n)}},o.prototype.removeNodes=function(e,t,o){this.removeNodesInStages(e,t,o),t.changedPath.isActive()&&e.forEach((function(e){return t.changedPath.addParentNode(e.parent)}))},o.prototype.removeNodesInStages=function(e,t,o){if(this.removeNodesFromParents(e,t,o),t.usingTreeData){this.postRemoveCreateFillerNodes(e,t);var n=e.map((function(e){return e.parent}));this.removeEmptyGroups(n,t)}},o.prototype.forEachParentGroup=function(e,t,o){for(var n=t;n&&n!==e.rootNode;)o(n),n=n.parent},o.prototype.removeNodesFromParents=function(e,t,o){var n=this,r=null==o,i=o||new a;e.forEach((function(e){n.removeFromParent(e,i),n.forEachParentGroup(t,e.parent,(function(t){i.removeFromAllLeafChildren(t,e)}))})),r&&i.flush()},o.prototype.postRemoveCreateFillerNodes=function(e,t){var o=this;e.forEach((function(e){if(e.hasChildren()){var n=o.getExistingPathForNode(e,t),r=o.findParentForNode(e,n,t);r.expanded=e.expanded,r.allLeafChildren=e.allLeafChildren,r.childrenAfterGroup=e.childrenAfterGroup,r.childrenMapped=e.childrenMapped,r.updateHasChildren(),r.childrenAfterGroup.forEach((function(e){return e.parent=r}))}}))},o.prototype.removeEmptyGroups=function(e,t){for(var o=this,n=!0,r=function(){n=!1;var r=new a;e.forEach((function(e){o.forEachParentGroup(t,e,(function(e){(function(e){var t=o.getChildrenMappedKey(e.key,e.rowGroupColumn),n=e.parent;return!(!n||!n.childrenMapped||!n.childrenMapped[t])&&!!e.isEmptyRowGroupNode()})(e)&&(n=!0,o.removeFromParent(e,r),e.setSelectedParams({newValue:!1,source:"rowGroupChanged"}))}))})),r.flush()};n;)r()},o.prototype.removeFromParent=function(e,o){e.parent&&(o?o.removeFromChildrenAfterGroup(e.parent,e):(t._.removeFromArray(e.parent.childrenAfterGroup,e),e.parent.updateHasChildren()));var n=this.getChildrenMappedKey(e.key,e.rowGroupColumn);e.parent&&e.parent.childrenMapped&&(e.parent.childrenMapped[n]=void 0),e.setRowTop(null),e.setRowIndex(null)},o.prototype.addToParent=function(e,t){var o=this.getChildrenMappedKey(e.key,e.rowGroupColumn);t&&(null!=t.childrenMapped&&(t.childrenMapped[o]=e),t.childrenAfterGroup.push(e),t.updateHasChildren())},o.prototype.areGroupColsEqual=function(e,o){return null!=e&&null!=o&&e.pivotMode===o.pivotMode&&(t._.areEqual(e.groupedCols,o.groupedCols)&&t._.areEqual(e.keyCreators,o.keyCreators))},o.prototype.checkAllGroupDataAfterColsChanged=function(e){var t=this,o=function(n){n&&n.forEach((function(n){if(!(!e.usingTreeData&&!n.group)){var r={field:n.field,key:n.key,rowGroupColumn:n.rowGroupColumn,leafNode:n.allLeafChildren[0]};t.setGroupData(n,r,e),o(n.childrenAfterGroup)}}))};o(e.rootNode.childrenAfterGroup)},o.prototype.shotgunResetEverything=function(e,t){if(!this.noChangeInGroupingColumns(e,t)){this.selectionService.filterFromSelection((function(e){return e&&!e.group}));var o=e.rootNode,n=e.groupedCols;o.leafGroup=!e.usingTreeData&&0===n.length,o.childrenAfterGroup=[],o.childrenMapped={},o.updateHasChildren();var r=o.sibling;r&&(r.childrenAfterGroup=o.childrenAfterGroup,r.childrenMapped=o.childrenMapped),this.insertNodes(o.allLeafChildren,e,!1)}},o.prototype.noChangeInGroupingColumns=function(e,t){var o=!1,n=this.columnModel.getGroupDisplayColumns(),r=n?n.map((function(e){return e.getId()})).join("-"):"";return t&&(o=e.usingTreeData||this.areGroupColsEqual(e,this.oldGroupingDetails),this.oldGroupDisplayColIds!==r&&this.checkAllGroupDataAfterColsChanged(e)),this.oldGroupingDetails=e,this.oldGroupDisplayColIds=r,o},o.prototype.insertNodes=function(e,t,o){var n=this;if(t.usingTreeData)for(var r=1,i=e.map((function(e){var o=n.getGroupInfo(e,t);return r=Math.max(r,o.length),[e,o]})),a=function(e){i.forEach((function(r){var i=u(r,2),a=i[0],l=i[1];l.length===e&&(n.insertOneNode(a,t,o,void 0,l),t.changedPath.isActive()&&t.changedPath.addParentNode(a.parent))}))},l=1;l<r;l++)a(l);else e.forEach((function(e){n.insertOneNode(e,t,o),t.changedPath.isActive()&&t.changedPath.addParentNode(e.parent)}))},o.prototype.insertOneNode=function(e,t,o,n,r){var i=null!=r?r:this.getGroupInfo(e,t),a=this.findParentForNode(e,i,t,n);a.group||console.warn("AG Grid: duplicate group keys for row data, keys should be unique",[a.data,e.data]),t.usingTreeData?this.swapGroupWithUserNode(a,e,o):(e.parent=a,e.level=i.length,a.childrenAfterGroup.push(e),a.updateHasChildren())},o.prototype.findParentForNode=function(e,t,o,n){var r=this,i=o.rootNode;return t.forEach((function(t,a){i=r.getOrCreateNextNode(i,t,a,o),(null==n?void 0:n.isRemoveFromAllLeafChildren(i,e))?null==n||n.preventRemoveFromAllLeafChildren(i,e):i.allLeafChildren.push(e)})),i},o.prototype.swapGroupWithUserNode=function(e,t,o){t.parent=e.parent,t.key=e.key,t.field=e.field,t.groupData=e.groupData,t.level=e.level,o||(t.expanded=e.expanded),t.leafGroup=e.leafGroup,t.rowGroupIndex=e.rowGroupIndex,t.allLeafChildren=e.allLeafChildren,t.childrenAfterGroup=e.childrenAfterGroup,t.childrenMapped=e.childrenMapped,t.sibling=e.sibling,t.updateHasChildren(),this.removeFromParent(e),t.childrenAfterGroup.forEach((function(e){return e.parent=t})),this.addToParent(t,e.parent)},o.prototype.getOrCreateNextNode=function(e,t,o,n){var r=this.getChildrenMappedKey(t.key,t.rowGroupColumn),i=e.childrenMapped?e.childrenMapped[r]:void 0;return i||(i=this.createGroup(t,e,o,n),this.addToParent(i,e)),i},o.prototype.createGroup=function(e,o,n,r){var i=new t.RowNode(this.beans);return i.group=!0,i.field=e.field,i.rowGroupColumn=e.rowGroupColumn,this.setGroupData(i,e,r),i.key=e.key,i.id=this.createGroupId(i,o,r.usingTreeData,n),i.level=n,i.leafGroup=!r.usingTreeData&&n===r.groupedColCount-1,i.allLeafChildren=[],i.setAllChildrenCount(0),i.rowGroupIndex=r.usingTreeData?null:n,i.childrenAfterGroup=[],i.childrenMapped={},i.updateHasChildren(),i.parent=r.includeParents?o:null,this.setExpandedInitialValue(r,i),i},o.prototype.createGroupId=function(e,o,n,r){var i;return i=n?function(e,t,o){if(o<0)return null;var n=t?i(t,t.parent,o-1):null;return"".concat(null==n?"":n+"-").concat(o,"-").concat(e.key)}:function(e,t){if(!e.rowGroupColumn)return null;var o=t?i(t,t.parent,0):null;return"".concat(null==o?"":o+"-").concat(e.rowGroupColumn.getColId(),"-").concat(e.key)},t.RowNode.ID_PREFIX_ROW_GROUP+i(e,o,r)},o.prototype.setGroupData=function(e,t,o){var n=this;e.groupData={},this.columnModel.getGroupDisplayColumns().forEach((function(r){if(o.usingTreeData)e.groupData[r.getColId()]=t.key;else{var i=e.rowGroupColumn;null!==i&&r.isRowGroupDisplayed(i.getId())&&(o.suppressGroupMaintainValueType?e.groupData[r.getColId()]=t.key:e.groupData[r.getColId()]=n.valueService.getValue(i,t.leafNode))}}))},o.prototype.getChildrenMappedKey=function(e,t){return t?t.getId()+"-"+e:e},o.prototype.setExpandedInitialValue=function(e,t){if(e.pivotMode&&t.leafGroup)t.expanded=!1;else{var o=e.isGroupOpenByDefault;if(o){var n={rowNode:t,field:t.field,key:t.key,level:t.level,rowGroupColumn:t.rowGroupColumn};t.expanded=1==o(n)}else{var r=e.expandByDefault;-1!==e.expandByDefault?t.expanded=t.level<r:t.expanded=!0}}},o.prototype.getGroupInfo=function(e,t){return t.usingTreeData?this.getGroupInfoFromCallback(e,t):this.getGroupInfoFromGroupColumns(e,t)},o.prototype.getGroupInfoFromCallback=function(e,o){var n=o.getDataPath?o.getDataPath(e.data):null;null!=n&&0!==n.length||t._.warnOnce("getDataPath() should not return an empty path for data ".concat(e.data));return n?n.map((function(e){return{key:e,field:null,rowGroupColumn:null}})):[]},o.prototype.getGroupInfoFromGroupColumns=function(e,t){var o=this,n=[];return t.groupedCols.forEach((function(r){var i=o.valueService.getKeyForNode(r,e),a=null!=i&&""!==i;if((t.pivotMode||!t.groupAllowUnbalanced)&&!a&&(i="",a=!0),a){var l={key:i,field:r.getColDef().field,rowGroupColumn:r,leafNode:e};n.push(l)}})),n},s([t.Autowired("columnModel")],o.prototype,"columnModel",void 0),s([t.Autowired("selectableService")],o.prototype,"selectableService",void 0),s([t.Autowired("valueService")],o.prototype,"valueService",void 0),s([t.Autowired("beans")],o.prototype,"beans",void 0),s([t.Autowired("selectionService")],o.prototype,"selectionService",void 0),o=s([t.Bean("groupStage")],o)}(t.BeanStub),d=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),h=function(){return(h=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},g=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},f=function(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var n,r,i=o.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},v=function(e,t,o){if(o||2===arguments.length)for(var n,r=0,i=t.length;r<i;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))},m=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}var n;return d(o,e),n=o,o.prototype.init=function(){var e=this,t=function(){var t;return null!==(t=e.gos.get("serverSidePivotResultFieldSeparator"))&&void 0!==t?t:"_"};this.fieldSeparator=t(),this.addManagedPropertyListener("serverSidePivotResultFieldSeparator",(function(){e.fieldSeparator=t()}));var o=function(){return e.gos.get("pivotDefaultExpanded")};this.pivotDefaultExpanded=o(),this.addManagedPropertyListener("pivotDefaultExpanded",(function(){e.pivotDefaultExpanded=o()}))},o.prototype.createPivotColumnDefs=function(e){var o=this.createPivotColumnsFromUniqueValues(e);var n=function e(t,o){return void 0===o&&(o=[]),t.forEach((function(t){void 0!==t.children?e(t.children,o):o.push(t)})),o}(o);return this.addRowGroupTotals(o,n),this.addExpandablePivotGroups(o,n),this.addPivotTotalsToGroups(o,n),{pivotColumnGroupDefs:o,pivotColumnDefs:n.map((function(e){return t._.cloneObject(e)}))}},o.prototype.createPivotColumnsFromUniqueValues=function(e){var t=this.columnModel.getPivotColumns(),o=t.length;return this.recursivelyBuildGroup(0,e,[],o,t)},o.prototype.recursivelyBuildGroup=function(e,o,n,r,i){var a=this,l=this.columnModel.getValueColumns();if(e>=r)return this.buildMeasureCols(n);var s=i[e].getColDef(),u=this.headerNameComparator.bind(this,s.pivotComparator);if(1===l.length&&this.gridOptionsService.get("removePivotHeaderRowWhenSingleValueColumn")&&e===r-1){var p=[];return t._.iterateObject(o,(function(e){var t=v(v([],f(n),!1),[e],!1),o=a.createColDef(l[0],e,t);o.columnGroupShow="open",p.push(o)})),p.sort(u),p}var c=[];return t._.iterateObject(o,(function(t,o){var l=-1===a.pivotDefaultExpanded||e<a.pivotDefaultExpanded,s=v(v([],f(n),!1),[t],!1);c.push({children:a.recursivelyBuildGroup(e+1,o,s,r,i),headerName:t,pivotKeys:s,columnGroupShow:"open",openByDefault:l,groupId:a.generateColumnGroupId(s)})})),c.sort(u),c},o.prototype.buildMeasureCols=function(e){var t=this,o=this.columnModel.getValueColumns();return 0===o.length?[this.createColDef(null,"-",e)]:o.map((function(o){var n=t.columnModel.getDisplayNameForColumn(o,"header");return h(h({},t.createColDef(o,n,e)),{columnGroupShow:"open"})}))},o.prototype.addExpandablePivotGroups=function(e,t){var o=this;if(!this.gridOptionsService.get("suppressExpandablePivotGroups")&&!this.gridOptionsService.get("pivotColumnGroupTotals")){var n=function(e,t,r){var i=e;if(i.children){var a=new Map;i.children.forEach((function(e){n(e,t,a)}));var l=!i.children.some((function(e){return e.children}));o.columnModel.getValueColumns().forEach((function(n){var r=o.columnModel.getDisplayNameForColumn(n,"header"),i=o.createColDef(n,r,e.pivotKeys);(i.pivotTotalColumnIds=a.get(n.getColId()),i.columnGroupShow="closed",i.aggFunc=n.getAggFunc(),l)||(e.children.push(i),t.push(i))})),o.merge(r,a)}else{var s=e;if(!s.pivotValueColumn)return;var u=s.pivotValueColumn.getColId(),p=r.has(u)?r.get(u):[];p.push(s.colId),r.set(u,p)}};e.forEach((function(e){n(e,t,new Map)}))}},o.prototype.addPivotTotalsToGroups=function(e,t){var o=this;if(this.gridOptionsService.get("pivotColumnGroupTotals")){var n="after"===this.gridOptionsService.get("pivotColumnGroupTotals"),r=this.columnModel.getValueColumns(),i=r.map((function(e){return e.getAggFunc()}));if(i&&!(i.length<1)&&this.sameAggFuncs(i)){var a=r[0];e.forEach((function(e){o.recursivelyAddPivotTotal(e,t,a,n)}))}}},o.prototype.recursivelyAddPivotTotal=function(e,t,o,n){var r=this,i=e;if(!i.children){var a=e;return a.colId?[a.colId]:null}var l=[];if(i.children.forEach((function(e){var i=r.recursivelyAddPivotTotal(e,t,o,n);i&&(l=l.concat(i))})),i.children.length>1){var s=this.localeService.getLocaleTextFunc()("pivotColumnGroupTotals","Total"),u=this.createColDef(o,s,e.pivotKeys,!0);u.pivotTotalColumnIds=l,u.aggFunc=o.getAggFunc();var p=e.children;n?p.push(u):p.unshift(u),t.push(u)}return l},o.prototype.addRowGroupTotals=function(e,t){var o=this;if(this.gridOptionsService.get("pivotRowTotals"))for(var n="after"===this.gridOptionsService.get("pivotRowTotals"),r=this.columnModel.getValueColumns(),i=n?r.slice():r.slice().reverse(),a=function(r){var a=i[r],s=[];e.forEach((function(e){s=s.concat(o.extractColIdsForValueColumn(e,a))}));var u=i.length>1||!l.gridOptionsService.get("removePivotHeaderRowWhenSingleValueColumn");l.createRowGroupTotal(e,t,a,s,n,u)},l=this,s=0;s<i.length;s++)a(s)},o.prototype.extractColIdsForValueColumn=function(e,t){var o=this,n=e;if(!n.children){var r=n;return r.pivotValueColumn===t&&r.colId?[r.colId]:[]}var i=[];return n.children.forEach((function(e){o.extractColIdsForValueColumn(e,t);var n=o.extractColIdsForValueColumn(e,t);i=i.concat(n)})),i},o.prototype.createRowGroupTotal=function(e,t,o,r,i,a){var l;if(0===this.columnModel.getValueColumns().length)l=this.createColDef(null,"-",[]);else{var s=this.columnModel.getDisplayNameForColumn(o,"header");(l=this.createColDef(o,s,[])).pivotTotalColumnIds=r}l.colId=n.PIVOT_ROW_TOTAL_PREFIX+l.colId,t.push(l);var u=a?{children:[l],pivotKeys:[],groupId:"".concat(n.PIVOT_ROW_TOTAL_PREFIX,"_pivotGroup_").concat(o.getColId())}:l;i?e.push(u):e.unshift(u)},o.prototype.createColDef=function(e,t,o,n){void 0===n&&(n=!1);var r={};if(e){var i=e.getColDef();Object.assign(r,i),r.hide=!1}return r.headerName=t,r.colId=this.generateColumnId(o||[],e&&!n?e.getColId():""),r.field=r.colId,r.valueGetter=function(e){var t;return null===(t=e.data)||void 0===t?void 0:t[e.colDef.field]},r.pivotKeys=o,r.pivotValueColumn=e,!0===r.filter&&(r.filter="agNumberColumnFilter"),r},o.prototype.sameAggFuncs=function(e){if(1==e.length)return!0;for(var t=1;t<e.length;t++)if(e[t]!==e[0])return!1;return!0},o.prototype.headerNameComparator=function(e,t,o){return e?e(t.headerName,o.headerName):t.headerName&&!o.headerName?1:!t.headerName&&o.headerName?-1:t.headerName&&o.headerName?t.headerName<o.headerName?-1:t.headerName>o.headerName?1:0:0},o.prototype.merge=function(e,t){t.forEach((function(t,o,n){var r=e.has(o)?e.get(o):[],i=v(v([],f(r),!1),f(t),!1);e.set(o,i)}))},o.prototype.generateColumnGroupId=function(e){var t=this.columnModel.getPivotColumns().map((function(e){return e.getColId()}));return"pivotGroup_".concat(t.join("-"),"_").concat(e.join("-"))},o.prototype.generateColumnId=function(e,t){var o=this.columnModel.getPivotColumns().map((function(e){return e.getColId()}));return"pivot_".concat(o.join("-"),"_").concat(e.join("-"),"_").concat(t)},o.prototype.createColDefsFromFields=function(e){for(var t=this,o={},n=0;n<e.length;n++)for(var r=e[n].split(this.fieldSeparator),i=o,a=0;a<r.length;a++){var l=r[a];null==i[l]&&(i[l]={}),i=i[l]}var s=function(e,o,n,r){var i,a=[];for(var l in n){var u=n[l],p=s("".concat(e).concat(t.fieldSeparator).concat(l),l,u,r+1);a.push(p)}if(0===a.length){var c={colId:e,headerName:o,valueGetter:function(t){var o;return null===(o=t.data)||void 0===o?void 0:o[e]}},d=t.columnModel.getPrimaryColumn(o);return d&&(c.headerName=null!==(i=t.columnModel.getDisplayNameForColumn(d,"header"))&&void 0!==i?i:o,c.aggFunc=d.getAggFunc(),c.pivotValueColumn=d),c}return t.gridOptionsService.get("removePivotHeaderRowWhenSingleValueColumn")&&1===a.length&&"colId"in a[0]?(a[0].headerName=o,a[0]):{openByDefault:-1===t.pivotDefaultExpanded||r<t.pivotDefaultExpanded,groupId:e,headerName:o,children:a}},u=[];for(var p in o){var c=s(p,p,o[p],0);u.push(c)}return u},o.PIVOT_ROW_TOTAL_PREFIX="PivotRowTotal_",g([t.Autowired("columnModel")],o.prototype,"columnModel",void 0),g([t.Autowired("gridOptionsService")],o.prototype,"gos",void 0),g([t.PostConstruct],o.prototype,"init",null),o=n=g([t.Bean("pivotColDefService")],o)}(t.BeanStub),y=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),C=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},A=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t.uniqueValues={},t}return y(o,e),o.prototype.execute=function(e){var t=e.changedPath;this.columnModel.isPivotActive()?this.executePivotOn(t):this.executePivotOff(t)},o.prototype.executePivotOff=function(e){this.aggregationColumnsHashLastTime=null,this.uniqueValues={},this.columnModel.isSecondaryColumnsPresent()&&(this.columnModel.setSecondaryColumns(null,"rowModelUpdated"),e&&e.setInactive())},o.prototype.executePivotOn=function(e){var t=this.bucketUpRowNodes(e),o=this.setUniqueValues(t),n=this.columnModel.getValueColumns(),r=n.map((function(e){return"".concat(e.getId(),"-").concat(e.getColDef().headerName)})).join("#"),i=n.map((function(e){return e.getAggFunc().toString()})).join("#"),a=this.aggregationColumnsHashLastTime!==r,l=this.aggregationFuncsHashLastTime!==i;this.aggregationColumnsHashLastTime=r,this.aggregationFuncsHashLastTime=i;var s=this.columnModel.getRowGroupColumns().map((function(e){return e.getId()})).join("#"),u=s!==this.groupColumnsHashLastTime;this.groupColumnsHashLastTime=s;var p=this.gridOptionsService.get("pivotRowTotals"),c=this.gridOptionsService.get("pivotColumnGroupTotals"),d=this.gridOptionsService.get("suppressExpandablePivotGroups"),h=this.gridOptionsService.get("removePivotHeaderRowWhenSingleValueColumn"),g=p!==this.pivotRowTotalsLastTime||c!==this.pivotColumnGroupTotalsLastTime||d!==this.suppressExpandablePivotGroupsLastTime||h!==this.removePivotHeaderRowWhenSingleValueColumnLastTime;if(this.pivotRowTotalsLastTime=p,this.pivotColumnGroupTotalsLastTime=c,this.suppressExpandablePivotGroupsLastTime=d,this.removePivotHeaderRowWhenSingleValueColumnLastTime=h,o||a||u||l||g){var f=this.pivotColDefService.createPivotColumnDefs(this.uniqueValues),v=f.pivotColumnGroupDefs,m=f.pivotColumnDefs;this.pivotColumnDefs=m,this.columnModel.setSecondaryColumns(v,"rowModelUpdated"),e&&e.setInactive()}},o.prototype.setUniqueValues=function(e){return!!(JSON.stringify(e)!==JSON.stringify(this.uniqueValues))&&(this.uniqueValues=e,!0)},o.prototype.bucketUpRowNodes=function(e){var t=this,o={};e.forEachChangedNodeDepthFirst((function(e){e.leafGroup&&(e.childrenMapped=null)}));var n=function(e){var r;e.leafGroup?t.bucketRowNode(e,o):null===(r=e.childrenAfterFilter)||void 0===r||r.forEach(n)};return e.executeFromRootNode(n),o},o.prototype.bucketRowNode=function(e,t){var o=this.columnModel.getPivotColumns();0===o.length?e.childrenMapped=null:e.childrenMapped=this.bucketChildren(e.childrenAfterFilter,o,0,t),e.sibling&&(e.sibling.childrenMapped=e.childrenMapped)},o.prototype.bucketChildren=function(e,o,n,r){var i=this,a={},l=o[n];if(e.forEach((function(e){var o=i.valueService.getKeyForNode(l,e);t._.missing(o)&&(o=""),r[o]||(r[o]={}),a[o]||(a[o]=[]),a[o].push(e)})),n===o.length-1)return a;var s={};return t._.iterateObject(a,(function(e,t){s[e]=i.bucketChildren(t,o,n+1,r[e])})),s},o.prototype.getPivotColumnDefs=function(){return this.pivotColumnDefs},C([t.Autowired("valueService")],o.prototype,"valueService",void 0),C([t.Autowired("columnModel")],o.prototype,"columnModel",void 0),C([t.Autowired("pivotColDefService")],o.prototype,"pivotColDefService",void 0),o=C([t.Bean("pivotStage")],o)}(t.BeanStub),G=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),S=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},D="undefined"==typeof BigInt?null:BigInt,F={sum:"Sum",first:"First",last:"Last",min:"Min",max:"Max",count:"Count",avg:"Average"},E=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t.aggFuncsMap={},t.initialised=!1,t}var n;return G(o,e),n=o,o.prototype.init=function(){this.initialised||(this.initialiseWithDefaultAggregations(),this.addAggFuncs(this.gridOptionsService.get("aggFuncs")))},o.prototype.initialiseWithDefaultAggregations=function(){this.aggFuncsMap[n.AGG_SUM]=O,this.aggFuncsMap[n.AGG_FIRST]=_,this.aggFuncsMap[n.AGG_LAST]=P,this.aggFuncsMap[n.AGG_MIN]=w,this.aggFuncsMap[n.AGG_MAX]=N,this.aggFuncsMap[n.AGG_COUNT]=b,this.aggFuncsMap[n.AGG_AVG]=T,this.initialised=!0},o.prototype.isAggFuncPossible=function(e,o){var n=this.getFuncNames(e),r=t._.includes(n,o),i=t._.exists(this.aggFuncsMap[o]);return r&&i},o.prototype.getDefaultFuncLabel=function(e){var t;return null!==(t=F[e])&&void 0!==t?t:e},o.prototype.getDefaultAggFunc=function(e){var o=e.getColDef().defaultAggFunc;if(t._.exists(o)&&this.isAggFuncPossible(e,o))return o;if(this.isAggFuncPossible(e,n.AGG_SUM))return n.AGG_SUM;var r=this.getFuncNames(e);return t._.existsAndNotEmpty(r)?r[0]:null},o.prototype.addAggFuncs=function(e){t._.iterateObject(e,this.addAggFunc.bind(this))},o.prototype.addAggFunc=function(e,t){this.init(),this.aggFuncsMap[e]=t},o.prototype.getAggFunc=function(e){return this.init(),this.aggFuncsMap[e]},o.prototype.getFuncNames=function(e){var t=e.getColDef().allowedAggFuncs;return null==t?Object.keys(this.aggFuncsMap).sort():t},o.prototype.clear=function(){this.aggFuncsMap={}},o.AGG_SUM="sum",o.AGG_FIRST="first",o.AGG_LAST="last",o.AGG_MIN="min",o.AGG_MAX="max",o.AGG_COUNT="count",o.AGG_AVG="avg",S([t.PostConstruct],o.prototype,"init",null),o=n=S([t.Bean("aggFuncService")],o)}(t.BeanStub);function O(e){for(var t=e.values,o=null,n=0;n<t.length;n++){var r=t[n];"number"==typeof r?null===o?o=r:o+=D?"number"==typeof o?r:D(r):r:"bigint"==typeof r&&(o=null===o?r:("bigint"==typeof o?o:D(o))+r)}return o}function _(e){return e.values.length>0?e.values[0]:null}function P(e){return e.values.length>0?t._.last(e.values):null}function w(e){for(var t=e.values,o=null,n=0;n<t.length;n++){var r=t[n];"number"!=typeof r&&"bigint"!=typeof r||!(null===o||o>r)||(o=r)}return o}function N(e){for(var t=e.values,o=null,n=0;n<t.length;n++){var r=t[n];"number"!=typeof r&&"bigint"!=typeof r||!(null===o||o<r)||(o=r)}return o}function b(e){for(var t,o,n=e.values,r=0,i=0;i<n.length;i++){var a=n[i];r+=null!=a&&"number"==typeof a.value?a.value:1}var l=null===(o=null===(t=e.rowNode)||void 0===t?void 0:t.aggData)||void 0===o?void 0:o[e.column.getColId()];return l&&l.value===r?l:{value:r,toString:function(){return this.value.toString()},toNumber:function(){return this.value}}}function T(e){for(var t,o,n,r=e.values,i=0,a=0,l=0;l<r.length;l++){var s=r[l],u=null;"number"==typeof s||"bigint"==typeof s?(u=s,a++):null==s||"number"!=typeof s.value&&"bigint"!=typeof s.value||"number"!=typeof s.count||(u=D?s.value*("number"==typeof s.value?s.count:D(s.count)):s.value*s.count,a+=s.count),"number"==typeof u?i+=D?"number"==typeof i?u:D(u):u:"bigint"==typeof u&&(i=("bigint"==typeof i?i:D(i))+u)}var p=null;a>0&&(p=D?i/("number"==typeof i?a:D(a)):i/a);var c=null===(o=null===(t=e.rowNode)||void 0===t?void 0:t.aggData)||void 0===o?void 0:o[null===(n=e.column)||void 0===n?void 0:n.getColId()];return c&&c.count===a&&c.value===p?c:{count:a,value:p,toString:function(){return"number"==typeof this.value||"bigint"==typeof this.value?this.value.toString():""},toNumber:function(){return this.value}}}var M=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),R=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},I=function(e){function o(t,o,n,r,i){var a=e.call(this)||this;return a.column=t,a.dragSourceDropTarget=o,a.ghost=n,a.dropZonePurpose=r,a.horizontal=i,a.popupShowing=!1,a}return M(o,e),o.prototype.init=function(){var e=this;this.setTemplate(o.TEMPLATE);var n=this.getGui(),r=this.gridOptionsService.get("functionsReadOnly");this.addElementClasses(n),this.addElementClasses(this.eDragHandle,"drag-handle"),this.addElementClasses(this.eText,"text"),this.addElementClasses(this.eButton,"button"),this.eDragHandle.appendChild(t._.createIconNoSpan("columnDrag",this.gridOptionsService)),this.eButton.appendChild(t._.createIconNoSpan("cancel",this.gridOptionsService)),this.setupSort(),this.displayName=this.columnModel.getDisplayNameForColumn(this.column,"columnDrop"),this.setupComponents(),this.ghost||r||this.addDragSource(),this.setupAria(),this.addManagedListener(this.eventService,t.Column.EVENT_SORT_CHANGED,(function(){e.setupAria()})),this.setupTooltip(),this.activateTabIndex();var i=function(){var o=e.isGroupingAndLocked();t._.setDisplayed(e.eButton,!o&&!e.gridOptionsService.get("functionsReadOnly")),e.eDragHandle.classList.toggle("ag-column-select-column-readonly",o),e.setupAria()};i(),this.isGroupingZone()&&this.addManagedPropertyListener("groupLockGroupColumns",(function(){return i()}))},o.prototype.setupAria=function(){var e=this.localeService.getLocaleTextFunc(),o=this.getColumnAndAggFuncName(),n=o.name,r=o.aggFuncName,i=e("ariaDropZoneColumnComponentAggFuncSeparator"," of "),a={asc:e("ariaDropZoneColumnComponentSortAscending","ascending"),desc:e("ariaDropZoneColumnComponentSortDescending","descending")},l=this.column.getSort(),s=this.gridOptionsService.get("rowGroupPanelSuppressSort"),u=[[r&&"".concat(r).concat(i),n,this.isGroupingZone()&&!s&&l&&", ".concat(a[l])].filter((function(e){return!!e})).join("")],p=this.gridOptionsService.get("functionsReadOnly");if(this.isAggregationZone()&&!p){var c=e("ariaDropZoneColumnValueItemDescription","Press ENTER to change the aggregation type");u.push(c)}if(this.isGroupingZone()&&this.column.isSortable()&&!s){var d=e("ariaDropZoneColumnGroupItemDescription","Press ENTER to sort");u.push(d)}if(!this.isGroupingAndLocked()){var h=e("ariaDropZoneColumnComponentDescription","Press DELETE to remove");u.push(h)}t._.setAriaLabel(this.getGui(),u.join(". "))},o.prototype.setupTooltip=function(){var e=this,o=function(){var t=e.column.getColDef().headerTooltip;e.setTooltip(t)};o(),this.addManagedListener(this.eventService,t.Events.EVENT_NEW_COLUMNS_LOADED,o)},o.prototype.setupSort=function(){var e=this,o=this.column.isSortable(),n=this.isGroupingZone();if(o&&n&&!this.gridOptionsService.get("rowGroupPanelSuppressSort")){this.eSortIndicator.setupSort(this.column,!0);var r=function(t){t.preventDefault();var o="ctrl"===e.gridOptionsService.get("multiSortKey")?t.ctrlKey||t.metaKey:t.shiftKey;e.sortController.progressSort(e.column,o,"uiColumnSorted")};this.addGuiEventListener("click",r),this.addGuiEventListener("keydown",(function(o){o.key===t.KeyCode.ENTER&&e.isGroupingZone()&&r(o)}))}},o.prototype.addDragSource=function(){var e=this,o={type:t.DragSourceType.ToolPanel,eElement:this.eDragHandle,getDefaultIconName:function(){return t.DragAndDropService.ICON_HIDE},getDragItem:function(){return e.createDragItem()},dragItemName:this.displayName,dragSourceDropTarget:this.dragSourceDropTarget};this.dragAndDropService.addDragSource(o,!0),this.addDestroyFunc((function(){return e.dragAndDropService.removeDragSource(o)}))},o.prototype.createDragItem=function(){var e={};return e[this.column.getId()]=this.column.isVisible(),{columns:[this.column],visibleState:e}},o.prototype.setupComponents=function(){this.setTextValue(),this.setupRemove(),this.ghost&&this.addCssClass("ag-column-drop-cell-ghost"),this.isAggregationZone()&&!this.gridOptionsService.get("functionsReadOnly")&&this.addGuiEventListener("click",this.onShowAggFuncSelection.bind(this))},o.prototype.isGroupingAndLocked=function(){return this.isGroupingZone()&&this.columnModel.isColumnGroupingLocked(this.column)},o.prototype.setupRemove=function(){var e=this;t._.setDisplayed(this.eButton,!this.isGroupingAndLocked()&&!this.gridOptionsService.get("functionsReadOnly"));var n={type:o.EVENT_COLUMN_REMOVE};this.addGuiEventListener("keydown",(function(o){var r=o.key===t.KeyCode.ENTER;o.key===t.KeyCode.DELETE&&(e.isGroupingAndLocked()||(o.preventDefault(),e.dispatchEvent(n))),r&&e.isAggregationZone()&&!e.gridOptionsService.get("functionsReadOnly")&&(o.preventDefault(),e.onShowAggFuncSelection())})),this.addManagedListener(this.eButton,"click",(function(t){e.dispatchEvent(n),t.stopPropagation()}));var r=new t.TouchListener(this.eButton);this.addManagedListener(r,t.TouchListener.EVENT_TAP,(function(){e.dispatchEvent(n)})),this.addDestroyFunc(r.destroy.bind(r))},o.prototype.getColumnAndAggFuncName=function(){var e=this.displayName,t="";if(this.isAggregationZone()){var o=this.column.getAggFunc(),n="string"==typeof o?o:"agg";t=this.localeService.getLocaleTextFunc()(n,n)}return{name:e,aggFuncName:t}},o.prototype.setTextValue=function(){var e=this.getColumnAndAggFuncName(),o=e.name,n=e.aggFuncName,r=this.isAggregationZone()?"".concat(n,"(").concat(o,")"):o,i=t._.escapeString(r);this.eText.innerHTML=i},o.prototype.onShowAggFuncSelection=function(){var e=this;if(!this.popupShowing){this.popupShowing=!0;var o=new t.VirtualList({cssIdentifier:"select-agg-func"}),n=this.aggFuncService.getFuncNames(this.column),r=this.getGui(),i=o.getGui();o.setModel({getRow:function(e){return n[e]},getRowCount:function(){return n.length}}),this.getContext().createBean(o);var a=t._.loadTemplate('<div class="ag-select-agg-func-popup"></div>');a.style.top="0px",a.style.left="0px",a.appendChild(i),a.style.width="".concat(r.clientWidth,"px");var l=this.addManagedListener(a,"focusout",(function(e){!a.contains(e.relatedTarget)&&u&&u.hideFunc()})),s=this.localeService.getLocaleTextFunc(),u=this.popupService.addPopup({modal:!0,eChild:a,closeOnEsc:!0,closedCallback:function(t){e.destroyBean(o),e.popupShowing=!1,"Escape"===(null==t?void 0:t.key)&&r.focus(),l&&l()},ariaLabel:s("ariaLabelAggregationFunction","Aggregation Function")});u&&o.setComponentCreator(this.createAggSelect.bind(this,u.hideFunc)),o.addGuiEventListener("keydown",(function(e){if(e.key===t.KeyCode.ENTER||e.key===t.KeyCode.SPACE){var n=o.getLastFocusedRow();if(null==n)return;var r=o.getComponentAt(n);r&&r.selectItem()}})),this.popupService.positionPopupByComponent({type:"aggFuncSelect",eventSource:r,ePopup:a,keepWithinBounds:!0,column:this.column,position:"under"}),o.refresh();var p=n.findIndex((function(t){return t===e.column.getAggFunc()}));-1===p&&(p=0),o.focusRow(p)}},o.prototype.createAggSelect=function(e,o){var n=this,r=this.localeService.getLocaleTextFunc(),i=o.toString(),a=r(i,i);return new L((function(){if(e(),n.gridOptionsService.get("functionsPassive")){var r={type:t.Events.EVENT_COLUMN_AGG_FUNC_CHANGE_REQUEST,columns:[n.column],aggFunc:o};n.eventService.dispatchEvent(r)}else n.columnModel.setColumnAggFunc(n.column,o,"toolPanelDragAndDrop")}),a)},o.prototype.addElementClasses=function(e,t){t=t?"-".concat(t):"";var o=this.horizontal?"horizontal":"vertical";e.classList.add("ag-column-drop-cell".concat(t),"ag-column-drop-".concat(o,"-cell").concat(t))},o.prototype.isAggregationZone=function(){return"aggregation"===this.dropZonePurpose},o.prototype.isGroupingZone=function(){return"rowGroup"===this.dropZonePurpose},o.EVENT_COLUMN_REMOVE="columnRemove",o.TEMPLATE='<span role="option">\n          <span ref="eDragHandle" class="ag-drag-handle ag-column-drop-cell-drag-handle" role="presentation"></span>\n          <span ref="eText" class="ag-column-drop-cell-text" aria-hidden="true"></span>\n          <ag-sort-indicator ref="eSortIndicator"></ag-sort-indicator>\n          <span ref="eButton" class="ag-column-drop-cell-button" role="presentation"></span>\n        </span>',R([t.Autowired("dragAndDropService")],o.prototype,"dragAndDropService",void 0),R([t.Autowired("columnModel")],o.prototype,"columnModel",void 0),R([t.Autowired("popupService")],o.prototype,"popupService",void 0),R([t.Optional("aggFuncService")],o.prototype,"aggFuncService",void 0),R([t.Autowired("sortController")],o.prototype,"sortController",void 0),R([t.RefSelector("eText")],o.prototype,"eText",void 0),R([t.RefSelector("eDragHandle")],o.prototype,"eDragHandle",void 0),R([t.RefSelector("eButton")],o.prototype,"eButton",void 0),R([t.RefSelector("eSortIndicator")],o.prototype,"eSortIndicator",void 0),R([t.PostConstruct],o.prototype,"init",null),o}(t.Component),L=function(e){function t(t,o){var n=e.call(this,'<div class="ag-select-agg-func-item"/>')||this;return n.selectItem=t,n.getGui().innerText=o,n.addGuiEventListener("click",n.selectItem),n}return M(t,e),t}(t.Component),x=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),V=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},U=function(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var n,r,i=o.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){r={error:e}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return a},j=function(e,t,o){if(o||2===arguments.length)for(var n,r=0,i=t.length;r<i;r++)!n&&r in t||(n||(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))},k=function(e){function o(n,r){var i=e.call(this,'<div class="ag-unselectable" role="presentation"></div>')||this;return i.horizontal=n,i.dropZonePurpose=r,i.state=o.STATE_NOT_DRAGGING,i.guiDestroyFunctions=[],i.childColumnComponents=[],i.resizeEnabled=!1,i.addElementClasses(i.getGui()),i.eColumnDropList=document.createElement("div"),i.addElementClasses(i.eColumnDropList,"list"),t._.setAriaRole(i.eColumnDropList,"listbox"),i}return x(o,e),o.prototype.isHorizontal=function(){return this.horizontal},o.prototype.toggleResizable=function(e){this.positionableFeature.setResizable(!!e&&{bottom:!0}),this.resizeEnabled=e},o.prototype.setBeans=function(e){this.beans=e},o.prototype.destroy=function(){this.destroyGui(),e.prototype.destroy.call(this)},o.prototype.destroyGui=function(){this.guiDestroyFunctions.forEach((function(e){return e()})),this.guiDestroyFunctions.length=0,this.childColumnComponents.length=0,t._.clearElement(this.getGui()),t._.clearElement(this.eColumnDropList)},o.prototype.init=function(e){this.params=e,this.createManagedBean(new t.ManagedFocusFeature(this.getFocusableElement(),{handleKeyDown:this.handleKeyDown.bind(this)})),this.addManagedListener(this.beans.eventService,t.Events.EVENT_NEW_COLUMNS_LOADED,this.refreshGui.bind(this)),this.addManagedPropertyListeners(["functionsReadOnly","rowGroupPanelSuppressSort","groupLockGroupColumns"],this.refreshGui.bind(this)),this.setupDropTarget(),this.positionableFeature=new t.PositionableFeature(this.getGui(),{minHeight:100}),this.createManagedBean(this.positionableFeature),this.refreshGui(),t._.setAriaLabel(this.eColumnDropList,this.getAriaLabel())},o.prototype.handleKeyDown=function(e){var o=!this.horizontal,n=e.key===t.KeyCode.DOWN,r=e.key===t.KeyCode.UP;if(!o){var i=this.gridOptionsService.get("enableRtl");n=!i&&e.key===t.KeyCode.RIGHT||i&&e.key===t.KeyCode.LEFT,r=!i&&e.key===t.KeyCode.LEFT||i&&e.key===t.KeyCode.RIGHT}if(n||r){var a=this.focusService.findNextFocusableElement(this.getFocusableElement(),!1,r);a&&(e.preventDefault(),a.focus())}},o.prototype.addElementClasses=function(e,t){t=t?"-".concat(t):"";var o=this.horizontal?"horizontal":"vertical";e.classList.add("ag-column-drop".concat(t),"ag-column-drop-".concat(o).concat(t))},o.prototype.setupDropTarget=function(){this.dropTarget={getContainer:this.getGui.bind(this),getIconName:this.getIconName.bind(this),onDragging:this.onDragging.bind(this),onDragEnter:this.onDragEnter.bind(this),onDragLeave:this.onDragLeave.bind(this),onDragStop:this.onDragStop.bind(this),isInterestedIn:this.isInterestedIn.bind(this)},this.beans.dragAndDropService.addDropTarget(this.dropTarget)},o.prototype.isInterestedIn=function(e){return e===t.DragSourceType.HeaderCell||e===t.DragSourceType.ToolPanel},o.prototype.minimumAllowedNewInsertIndex=function(){var e=this.gridOptionsService.get("groupLockGroupColumns"),t=this.colModel.getRowGroupColumns().length;return-1===e?t:Math.min(e,t)},o.prototype.checkInsertIndex=function(e){var t=this.getNewInsertIndex(e);if(t<0)return!1;var o=this.minimumAllowedNewInsertIndex(),n=Math.max(o,t),r=n!==this.insertIndex;return r&&(this.insertIndex=n),r},o.prototype.getNewInsertIndex=function(e){var t=this,o=e.event,n=this.horizontal?o.clientX:o.clientY,r=this.childColumnComponents.map((function(e){return e.getGui().getBoundingClientRect()})),i=r.findIndex((function(e){return t.horizontal?e.right>n&&e.left<n:e.top<n&&e.bottom>n}));if(-1===i){var a=this.beans.gridOptionsService.get("enableRtl");return r.every((function(e){return n>(t.horizontal?e.right:e.bottom)}))?a&&this.horizontal?0:this.childColumnComponents.length:r.every((function(e){return n<(t.horizontal?e.left:e.top)}))?a&&this.horizontal?this.childColumnComponents.length:0:this.insertIndex}return this.insertIndex<=i?i+1:i},o.prototype.checkDragStartedBySelf=function(e){this.state===o.STATE_NOT_DRAGGING&&(this.state=o.STATE_REARRANGE_COLUMNS,this.potentialDndColumns=e.dragSource.getDragItem().columns||[],this.refreshGui(),this.checkInsertIndex(e),this.refreshGui())},o.prototype.onDragging=function(e){this.checkDragStartedBySelf(e),this.checkInsertIndex(e)&&this.refreshGui()},o.prototype.onDragEnter=function(e){var t=e.dragSource.getDragItem().columns||[];this.state=o.STATE_NEW_COLUMNS_IN;var n=t.filter(this.isColumnDroppable.bind(this));if(n.length>0){if(this.isRowGroupPanel()&&!this.gridOptionsService.get("suppressRowGroupHidesColumns")&&!e.fromNudge){var r=e.dragSource.getDragItem().columns;this.setColumnsVisible(r,!1,"uiColumnDragged")}this.potentialDndColumns=n,this.checkInsertIndex(e),this.refreshGui()}},o.prototype.setColumnsVisible=function(e,t,o){if(void 0===o&&(o="api"),e){var n=e.filter((function(e){return!e.getColDef().lockVisible}));this.colModel.setColumnsVisible(n,t,o)}},o.prototype.isPotentialDndColumns=function(){return t._.existsAndNotEmpty(this.potentialDndColumns)},o.prototype.isRowGroupPanel=function(){return"rowGroup"===this.dropZonePurpose},o.prototype.onDragLeave=function(e){if(this.state===o.STATE_REARRANGE_COLUMNS){var t=e.dragSource.getDragItem().columns||[];this.removeColumns(t)}if(this.isPotentialDndColumns()){if(this.isRowGroupPanel()&&!this.gridOptionsService.get("suppressMakeColumnVisibleAfterUnGroup")&&!e.fromNudge){var n=e.dragSource.getDragItem();this.setColumnsVisible(n.columns,!0,"uiColumnDragged")}this.potentialDndColumns=[],this.refreshGui()}this.state=o.STATE_NOT_DRAGGING},o.prototype.onDragStop=function(){if(this.isPotentialDndColumns()){var e=!1;this.state===o.STATE_NEW_COLUMNS_IN?(this.addColumns(this.potentialDndColumns),e=!0):e=this.rearrangeColumns(this.potentialDndColumns),this.potentialDndColumns=[],this.beans.gridOptionsService.get("functionsPassive")&&e||this.refreshGui()}this.state=o.STATE_NOT_DRAGGING},o.prototype.removeColumns=function(e){var o=this.getExistingColumns().filter((function(o){return!t._.includes(e,o)}));this.updateColumns(o)},o.prototype.addColumns=function(e){if(e){var o=this.getExistingColumns().slice(),n=e.filter((function(e){return o.indexOf(e)<0}));t._.insertArrayIntoArray(o,n,this.insertIndex),this.updateColumns(o)}},o.prototype.rearrangeColumns=function(e){var o=this.getNonGhostColumns().slice();return t._.insertArrayIntoArray(o,e,this.insertIndex),!t._.areEqual(o,this.getExistingColumns())&&(this.updateColumns(o),!0)},o.prototype.refreshGui=function(){var e=this.eColumnDropList.scrollTop,t=this.resizeEnabled,o=this.getFocusedItem(),n=this.focusService.findNextFocusableElement();n||(n=this.focusService.findNextFocusableElement(void 0,!1,!0)),this.toggleResizable(!1),this.destroyGui(),this.addIconAndTitleToGui(),this.addEmptyMessageToGui(),this.addColumnsToGui(),this.isHorizontal()||(this.eColumnDropList.scrollTop=e),t&&this.toggleResizable(t),this.focusService.isKeyboardMode()&&this.restoreFocus(o,n)},o.prototype.getFocusedItem=function(){var e=this.getGui(),t=this.gridOptionsService.getDocument().activeElement;return e.contains(t)?Array.from(e.querySelectorAll(".ag-column-drop-cell")).indexOf(t):-1},o.prototype.restoreFocus=function(e,t){var o=this.getGui(),n=Array.from(o.querySelectorAll(".ag-column-drop-cell"));if(-1!==e){0===n.length&&t.focus();var r=n[Math.min(n.length-1,e)];r&&r.focus()}},o.prototype.getNonGhostColumns=function(){var e=this,o=this.getExistingColumns();return this.isPotentialDndColumns()?o.filter((function(o){return!t._.includes(e.potentialDndColumns,o)})):o},o.prototype.addColumnsToGui=function(){var e=this,t=this.getNonGhostColumns().map((function(t){return e.createColumnComponent(t,!1)}));if(this.isPotentialDndColumns()){var o=this.potentialDndColumns.map((function(t){return e.createColumnComponent(t,!0)}));this.insertIndex>=t.length?t.push.apply(t,j([],U(o),!1)):t.splice.apply(t,j([this.insertIndex,0],U(o),!1))}this.appendChild(this.eColumnDropList),t.forEach((function(t,o){o>0&&e.addArrow(e.eColumnDropList),e.eColumnDropList.appendChild(t.getGui())})),this.addAriaLabelsToComponents()},o.prototype.addAriaLabelsToComponents=function(){var e=this;this.childColumnComponents.forEach((function(o,n){var r=o.getGui();t._.setAriaPosInSet(r,n+1),t._.setAriaSetSize(r,e.childColumnComponents.length)}))},o.prototype.createColumnComponent=function(e,t){var o=this,n=new I(e,this.dropTarget,t,this.dropZonePurpose,this.horizontal);return n.addEventListener(I.EVENT_COLUMN_REMOVE,this.removeColumns.bind(this,[e])),this.beans.context.createBean(n),this.guiDestroyFunctions.push((function(){return o.destroyBean(n)})),t||this.childColumnComponents.push(n),n},o.prototype.addIconAndTitleToGui=function(){var e=this.params.icon,o=document.createElement("div");if(t._.setAriaHidden(o,!0),this.addElementClasses(o,"title-bar"),this.addElementClasses(e,"icon"),this.addOrRemoveCssClass("ag-column-drop-empty",this.isExistingColumnsEmpty()),o.appendChild(e),!this.horizontal){var n=document.createElement("span");this.addElementClasses(n,"title"),n.innerHTML=this.params.title,o.appendChild(n)}this.appendChild(o)},o.prototype.isExistingColumnsEmpty=function(){return 0===this.getExistingColumns().length},o.prototype.addEmptyMessageToGui=function(){if(this.isExistingColumnsEmpty()&&!this.isPotentialDndColumns()){var e=document.createElement("span");e.innerHTML=this.params.emptyMessage,this.addElementClasses(e,"empty-message"),this.eColumnDropList.appendChild(e)}},o.prototype.addArrow=function(e){if(this.horizontal){var o=this.beans.gridOptionsService.get("enableRtl"),n=t._.createIconNoSpan(o?"smallLeft":"smallRight",this.beans.gridOptionsService);this.addElementClasses(n,"cell-separator"),e.appendChild(n)}},o.STATE_NOT_DRAGGING="notDragging",o.STATE_NEW_COLUMNS_IN="newColumnsIn",o.STATE_REARRANGE_COLUMNS="rearrangeColumns",V([t.Autowired("columnModel")],o.prototype,"colModel",void 0),V([t.Autowired("focusService")],o.prototype,"focusService",void 0),o}(t.Component),B=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),H=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},W=function(e){function o(t){return e.call(this,t,"rowGroup")||this}return B(o,e),o.prototype.passBeansUp=function(){e.prototype.setBeans.call(this,{gridOptionsService:this.gridOptionsService,eventService:this.eventService,context:this.getContext(),loggerFactory:this.loggerFactory,dragAndDropService:this.dragAndDropService});var o=this.localeService.getLocaleTextFunc(),n=o("rowGroupColumnsEmptyMessage","Drag here to set row groups"),r=o("groups","Row Groups");e.prototype.init.call(this,{dragAndDropIcon:t.DragAndDropService.ICON_GROUP,icon:t._.createIconNoSpan("rowGroupPanel",this.gridOptionsService,null),emptyMessage:n,title:r}),this.addManagedListener(this.eventService,t.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,this.refreshGui.bind(this))},o.prototype.getAriaLabel=function(){return this.localeService.getLocaleTextFunc()("ariaRowGroupDropZonePanelLabel","Row Groups")},o.prototype.getTooltipParams=function(){var t=e.prototype.getTooltipParams.call(this);return t.location="rowGroupColumnsList",t},o.prototype.isColumnDroppable=function(e){return!(this.gridOptionsService.get("functionsReadOnly")||!e.isPrimary())&&(e.isAllowRowGroup()&&!e.isRowGroupActive())},o.prototype.updateColumns=function(e){if(this.gridOptionsService.get("functionsPassive")){var o={type:t.Events.EVENT_COLUMN_ROW_GROUP_CHANGE_REQUEST,columns:e};this.eventService.dispatchEvent(o)}else this.columnModel.setRowGroupColumns(e,"toolPanelUi")},o.prototype.getIconName=function(){return this.isPotentialDndColumns()?t.DragAndDropService.ICON_GROUP:t.DragAndDropService.ICON_NOT_ALLOWED},o.prototype.getExistingColumns=function(){return this.columnModel.getRowGroupColumns()},H([t.Autowired("columnModel")],o.prototype,"columnModel",void 0),H([t.Autowired("loggerFactory")],o.prototype,"loggerFactory",void 0),H([t.Autowired("dragAndDropService")],o.prototype,"dragAndDropService",void 0),H([t.PostConstruct],o.prototype,"passBeansUp",null),o}(k),K=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),Z=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},z=function(e){function o(t){return e.call(this,t,"pivot")||this}return K(o,e),o.prototype.passBeansUp=function(){e.prototype.setBeans.call(this,{gridOptionsService:this.gridOptionsService,eventService:this.eventService,context:this.getContext(),loggerFactory:this.loggerFactory,dragAndDropService:this.dragAndDropService});var o=this.localeService.getLocaleTextFunc(),n=o("pivotColumnsEmptyMessage","Drag here to set column labels"),r=o("pivots","Column Labels");e.prototype.init.call(this,{dragAndDropIcon:t.DragAndDropService.ICON_GROUP,icon:t._.createIconNoSpan("pivotPanel",this.gridOptionsService,null),emptyMessage:n,title:r}),this.addManagedListener(this.eventService,t.Events.EVENT_NEW_COLUMNS_LOADED,this.refresh.bind(this)),this.addManagedListener(this.eventService,t.Events.EVENT_COLUMN_PIVOT_CHANGED,this.refresh.bind(this)),this.addManagedListener(this.eventService,t.Events.EVENT_COLUMN_PIVOT_MODE_CHANGED,this.checkVisibility.bind(this)),this.refresh()},o.prototype.getAriaLabel=function(){return this.localeService.getLocaleTextFunc()("ariaPivotDropZonePanelLabel","Column Labels")},o.prototype.getTooltipParams=function(){var t=e.prototype.getTooltipParams.call(this);return t.location="pivotColumnsList",t},o.prototype.refresh=function(){this.checkVisibility(),this.refreshGui()},o.prototype.checkVisibility=function(){var e=this.columnModel.isPivotMode();if(this.isHorizontal())switch(this.gridOptionsService.get("pivotPanelShow")){case"always":this.setDisplayed(e);break;case"onlyWhenPivoting":var t=this.columnModel.isPivotActive();this.setDisplayed(e&&t);break;default:this.setDisplayed(!1)}else this.setDisplayed(e)},o.prototype.isColumnDroppable=function(e){return!(this.gridOptionsService.get("functionsReadOnly")||!e.isPrimary())&&(e.isAllowPivot()&&!e.isPivotActive())},o.prototype.updateColumns=function(e){if(this.gridOptionsService.get("functionsPassive")){var o={type:t.Events.EVENT_COLUMN_PIVOT_CHANGE_REQUEST,columns:e};this.eventService.dispatchEvent(o)}else this.columnModel.setPivotColumns(e,"toolPanelUi")},o.prototype.getIconName=function(){return this.isPotentialDndColumns()?t.DragAndDropService.ICON_PIVOT:t.DragAndDropService.ICON_NOT_ALLOWED},o.prototype.getExistingColumns=function(){return this.columnModel.getPivotColumns()},Z([t.Autowired("columnModel")],o.prototype,"columnModel",void 0),Z([t.Autowired("loggerFactory")],o.prototype,"loggerFactory",void 0),Z([t.Autowired("dragAndDropService")],o.prototype,"dragAndDropService",void 0),Z([t.PostConstruct],o.prototype,"passBeansUp",null),o}(k),q=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),X=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},Q=function(e){function o(){return e.call(this)||this}return q(o,e),o.prototype.postConstruct=function(){var e=this;this.setGui(this.createNorthPanel()),this.addManagedListener(this.eventService,t.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,(function(){return e.onRowGroupChanged()})),this.addManagedListener(this.eventService,t.Events.EVENT_NEW_COLUMNS_LOADED,(function(){return e.onRowGroupChanged()})),this.addManagedPropertyListener("rowGroupPanelShow",(function(){return e.onRowGroupChanged()})),this.addManagedPropertyListener("pivotPanelShow",(function(){return e.onPivotPanelShow()})),this.onRowGroupChanged()},o.prototype.createNorthPanel=function(){var e=this,o=document.createElement("div");return o.classList.add("ag-column-drop-wrapper"),t._.setAriaRole(o,"presentation"),this.rowGroupComp=new W(!0),this.createManagedBean(this.rowGroupComp),this.pivotComp=new z(!0),this.createManagedBean(this.pivotComp),o.appendChild(this.rowGroupComp.getGui()),o.appendChild(this.pivotComp.getGui()),this.addManagedListener(this.rowGroupComp,t.Component.EVENT_DISPLAYED_CHANGED,(function(){return e.onDropPanelVisible()})),this.addManagedListener(this.pivotComp,t.Component.EVENT_DISPLAYED_CHANGED,(function(){return e.onDropPanelVisible()})),this.onDropPanelVisible(),o},o.prototype.onDropPanelVisible=function(){var e=this.rowGroupComp.isDisplayed()&&this.pivotComp.isDisplayed();this.rowGroupComp.addOrRemoveCssClass("ag-column-drop-horizontal-half-width",e),this.pivotComp.addOrRemoveCssClass("ag-column-drop-horizontal-half-width",e)},o.prototype.onRowGroupChanged=function(){if(this.rowGroupComp){var e=this.gridOptionsService.get("rowGroupPanelShow");if("always"===e)this.rowGroupComp.setDisplayed(!0);else if("onlyWhenGrouping"===e){var t=!this.columnModel.isRowGroupEmpty();this.rowGroupComp.setDisplayed(t)}else this.rowGroupComp.setDisplayed(!1)}},o.prototype.onPivotPanelShow=function(){if(this.pivotComp){var e=this.gridOptionsService.get("pivotPanelShow");if("always"===e)this.pivotComp.setDisplayed(!0);else if("onlyWhenPivoting"===e){var t=this.columnModel.isPivotActive();this.pivotComp.setDisplayed(t)}else this.pivotComp.setDisplayed(!1)}},X([t.Autowired("columnModel")],o.prototype,"columnModel",void 0),X([t.PostConstruct],o.prototype,"postConstruct",null),o}(t.Component),Y=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),J=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},$=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return Y(o,e),o.prototype.execute=function(e){var t=this,o=this.columnModel.isPivotMode(),n=this.filterManager.isAggregateFilterPresent()||this.filterManager.isAggregateQuickFilterPresent(),r=this.gridOptionsService.getGroupAggFiltering()||(o?function(e){return e.node.leafGroup}:function(e){return!e.node.group}),i=e.changedPath,a=function(e,o){void 0===o&&(o=!1),e.childrenAfterFilter&&(e.childrenAfterAggFilter=e.childrenAfterFilter,o&&e.childrenAfterAggFilter.forEach((function(e){return a(e,o)})),t.setAllChildrenCount(e)),e.sibling&&(e.sibling.childrenAfterAggFilter=e.childrenAfterAggFilter)};i.forEachChangedNodeDepthFirst(n?function(e){var o;e.childrenAfterAggFilter=(null===(o=e.childrenAfterFilter)||void 0===o?void 0:o.filter((function(e){var o;if(r({node:e})&&t.filterManager.doesRowPassAggregateFilters({rowNode:e}))return a(e,!0),!0;return null===(o=e.childrenAfterAggFilter)||void 0===o?void 0:o.length})))||null,t.setAllChildrenCount(e),e.sibling&&(e.sibling.childrenAfterAggFilter=e.childrenAfterAggFilter)}:a,!0)},o.prototype.setAllChildrenCountTreeData=function(e){var t=0;e.childrenAfterAggFilter.forEach((function(e){t++,t+=e.allChildrenCount})),e.setAllChildrenCount(t)},o.prototype.setAllChildrenCountGridGrouping=function(e){var t=0;e.childrenAfterAggFilter.forEach((function(e){e.group?t+=e.allChildrenCount:t++})),e.setAllChildrenCount(t)},o.prototype.setAllChildrenCount=function(e){e.hasChildren()?this.gridOptionsService.get("treeData")?this.setAllChildrenCountTreeData(e):this.setAllChildrenCountGridGrouping(e):e.setAllChildrenCount(null)},J([t.Autowired("filterManager")],o.prototype,"filterManager",void 0),J([t.Autowired("columnModel")],o.prototype,"columnModel",void 0),o=J([t.Bean("filterAggregatesStage")],o)}(t.BeanStub),ee=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),te=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},oe=function(e){function o(){return e.call(this,'\n            <div class="ag-group-filter">\n                <div ref="eGroupField"></div>\n                <div ref="eUnderlyingFilter"></div>\n            </div>\n        ')||this}return ee(o,e),o.prototype.postConstruct=function(){this.initialiseTabGuard({})},o.prototype.init=function(e){var o=this;return this.params=e,this.validateParams(),this.updateGroups().then((function(){o.addManagedListener(o.eventService,t.Events.EVENT_COLUMN_ROW_GROUP_CHANGED,(function(){return o.onColumnRowGroupChanged()}))}))},o.prototype.validateParams=function(){var e=this.params.colDef;e.field&&t._.warnOnce('Group Column Filter does not work with the colDef property "field". This property will be ignored.'),e.filterValueGetter&&t._.warnOnce('Group Column Filter does not work with the colDef property "filterValueGetter". This property will be ignored.'),e.filterParams&&t._.warnOnce('Group Column Filter does not work with the colDef property "filterParams". This property will be ignored.')},o.prototype.updateGroups=function(){var e=this.updateGroupField();return this.getUnderlyingFilters(e)},o.prototype.getSourceColumns=function(){if(this.groupColumn=this.params.column,this.gridOptionsService.get("treeData"))return t._.warnOnce("Group Column Filter does not work with Tree Data enabled. Please disable Tree Data, or use a different filter."),[];var e=this.columnModel.getSourceColumnsForGroupColumn(this.groupColumn);return e||(t._.warnOnce("Group Column Filter only works on group columns. Please use a different filter."),[])},o.prototype.updateGroupField=function(){var e=this;t._.clearElement(this.eGroupField),this.eGroupFieldSelect&&this.destroyBean(this.eGroupFieldSelect);var o=this.getSourceColumns(),n=o.filter((function(e){return e.isFilterAllowed()}));return n.length?(1===o.length?(this.selectedColumn=n[0],t._.setDisplayed(this.eGroupField,!1)):(this.selectedColumn&&n.some((function(t){return t.getId()===e.selectedColumn.getId()}))||(this.selectedColumn=n[0]),this.createGroupFieldSelectElement(n),this.eGroupField.appendChild(this.eGroupFieldSelect.getGui()),this.eGroupField.appendChild(t._.loadTemplate('<div class="ag-filter-separator"></div>')),t._.setDisplayed(this.eGroupField,!0)),n):(this.selectedColumn=void 0,t._.setDisplayed(this.eGroupField,!1),null)},o.prototype.createGroupFieldSelectElement=function(e){var o=this;this.eGroupFieldSelect=this.createManagedBean(new t.AgSelect);var n=this.localeService.getLocaleTextFunc();this.eGroupFieldSelect.setLabel(n("groupFilterSelect","Select field:")),this.eGroupFieldSelect.setLabelAlignment("top"),this.eGroupFieldSelect.addOptions(e.map((function(e){var t;return{value:e.getId(),text:null!==(t=o.columnModel.getDisplayNameForColumn(e,"groupFilter",!1))&&void 0!==t?t:void 0}}))),this.eGroupFieldSelect.setValue(this.selectedColumn.getId()),this.eGroupFieldSelect.onValueChange((function(e){return o.updateSelectedColumn(e)})),this.eGroupFieldSelect.addCssClass("ag-group-filter-field-select-wrapper"),1===e.length&&this.eGroupFieldSelect.setDisabled(!0)},o.prototype.getUnderlyingFilters=function(e){var o=this;if(!e)return this.filterColumnPairs=void 0,this.selectedFilter=void 0,this.groupColumn.setFilterActive(!1,"columnRowGroupChanged"),t.AgPromise.resolve();var n=[],r=[];return e.forEach((function(e){var t=o.filterManager.getOrCreateFilterWrapper(e,"COLUMN_MENU");(null==t?void 0:t.filterPromise)&&n.push(t.filterPromise.then((function(t){return t&&r.push({filter:t,column:e}),e.getId()===o.selectedColumn.getId()&&(o.selectedFilter=null!=t?t:void 0),t})))})),t.AgPromise.all(n).then((function(){o.filterColumnPairs=r,o.groupColumn.setFilterActive(o.isFilterActive(),"columnRowGroupChanged")}))},o.prototype.addUnderlyingFilterElement=function(){var e=this;if(t._.clearElement(this.eUnderlyingFilter),!this.selectedColumn)return t.AgPromise.resolve();var o=this.filterManager.getOrCreateFilterWrapper(this.selectedColumn,"COLUMN_MENU");return o?o.guiPromise.then((function(t){var n;e.eUnderlyingFilter.appendChild(t),null===(n=o.filterPromise)||void 0===n||n.then((function(t){var o,n;null===(o=null==t?void 0:t.afterGuiAttached)||void 0===o||o.call(t,e.afterGuiAttachedParams),(null===(n=e.afterGuiAttachedParams)||void 0===n?void 0:n.suppressFocus)||!e.eGroupFieldSelect||e.eGroupFieldSelect.isDisabled()||e.eGroupFieldSelect.getFocusableElement().focus()}))})):t.AgPromise.resolve()},o.prototype.updateSelectedColumn=function(e){var t,n;if(e){null===(n=null===(t=this.selectedFilter)||void 0===t?void 0:t.afterGuiDetached)||void 0===n||n.call(t);var r=this.getFilterColumnPair(e);this.selectedColumn=null==r?void 0:r.column,this.selectedFilter=null==r?void 0:r.filter,this.dispatchEvent({type:o.EVENT_SELECTED_COLUMN_CHANGED}),this.addUnderlyingFilterElement()}},o.prototype.isFilterActive=function(){var e;return!!(null===(e=this.filterColumnPairs)||void 0===e?void 0:e.some((function(e){return e.filter.isFilterActive()})))},o.prototype.doesFilterPass=function(){return!0},o.prototype.getModel=function(){return null},o.prototype.setModel=function(){return t.AgPromise.resolve()},o.prototype.afterGuiAttached=function(e){this.afterGuiAttachedParams=e,this.addUnderlyingFilterElement()},o.prototype.afterGuiDetached=function(){var e,o;t._.clearElement(this.eUnderlyingFilter),null===(o=null===(e=this.selectedFilter)||void 0===e?void 0:e.afterGuiDetached)||void 0===o||o.call(e)},o.prototype.onColumnRowGroupChanged=function(){var e=this;this.updateGroups().then((function(){e.dispatchEvent({type:o.EVENT_COLUMN_ROW_GROUP_CHANGED}),e.eventService.dispatchEvent({type:"filterAllowedUpdated"})}))},o.prototype.getFilterColumnPair=function(e){var t;if(e)return null===(t=this.filterColumnPairs)||void 0===t?void 0:t.find((function(t){return t.column.getId()===e}))},o.prototype.getSelectedFilter=function(){return this.selectedFilter},o.prototype.getSelectedColumn=function(){return this.selectedColumn},o.prototype.isFilterAllowed=function(){return!!this.selectedColumn},o.prototype.destroy=function(){e.prototype.destroy.call(this)},o.EVENT_COLUMN_ROW_GROUP_CHANGED="columnRowGroupChanged",o.EVENT_SELECTED_COLUMN_CHANGED="selectedColumnChanged",te([t.Autowired("filterManager")],o.prototype,"filterManager",void 0),te([t.Autowired("columnModel")],o.prototype,"columnModel",void 0),te([t.RefSelector("eGroupField")],o.prototype,"eGroupField",void 0),te([t.RefSelector("eUnderlyingFilter")],o.prototype,"eUnderlyingFilter",void 0),te([t.PostConstruct],o.prototype,"postConstruct",null),o}(t.TabGuardComp),ne=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),re=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},ie=function(e){function o(){var t=e.call(this,'\n            <div ref="eFloatingFilter" class="ag-group-floating-filter ag-floating-filter-input" role="presentation"></div>\n        ')||this;return t.haveAddedColumnListeners=!1,t}return ne(o,e),o.prototype.init=function(e){var o=this;this.params=e;var n="multipleColumns"===this.gridOptionsService.get("groupDisplayType");return new t.AgPromise((function(e){o.params.parentFilterInstance((function(t){o.parentFilterInstance=t,n?o.setupUnderlyingFloatingFilterElement().then((function(){return e()})):(o.setupReadOnlyFloatingFilterElement(),e())}))})).then((function(){o.addManagedListener(o.parentFilterInstance,oe.EVENT_SELECTED_COLUMN_CHANGED,(function(){return o.onSelectedColumnChanged()})),o.addManagedListener(o.parentFilterInstance,oe.EVENT_COLUMN_ROW_GROUP_CHANGED,(function(){return o.onColumnRowGroupChanged()}))}))},o.prototype.onParamsUpdated=function(e){this.params=e,this.setParams()},o.prototype.setParams=function(){var e,t=this.columnModel.getDisplayNameForColumn(this.params.column,"header",!0),o=this.localeService.getLocaleTextFunc();null===(e=this.eFloatingFilterText)||void 0===e||e.setInputAriaLabel("".concat(t," ").concat(o("ariaFilterInput","Filter Input")))},o.prototype.setupReadOnlyFloatingFilterElement=function(){var e=this;this.eFloatingFilterText||(this.eFloatingFilterText=this.createManagedBean(new t.AgInputTextField),this.eFloatingFilterText.setDisabled(!0).addGuiEventListener("click",(function(){return e.params.showParentFilter()})),this.setParams()),this.updateDisplayedValue(),this.eFloatingFilter.appendChild(this.eFloatingFilterText.getGui())},o.prototype.setupUnderlyingFloatingFilterElement=function(){var e=this;this.showingUnderlyingFloatingFilter=!1,this.underlyingFloatingFilter=void 0,t._.clearElement(this.eFloatingFilter);var o=this.parentFilterInstance.getSelectedColumn();if(o&&!o.isVisible()){var n=this.filterManager.getFloatingFilterCompDetails(o,this.params.showParentFilter);if(n)return this.compDetails=n,this.haveAddedColumnListeners||(this.haveAddedColumnListeners=!0,this.addManagedListener(o,t.Column.EVENT_VISIBLE_CHANGED,this.onColumnVisibleChanged.bind(this)),this.addManagedListener(o,t.Column.EVENT_COL_DEF_CHANGED,this.onColDefChanged.bind(this))),n.newAgStackInstance().then((function(t){var o,n;e.underlyingFloatingFilter=t,null===(o=e.underlyingFloatingFilter)||void 0===o||o.onParentModelChanged(null===(n=e.parentFilterInstance.getSelectedFilter())||void 0===n?void 0:n.getModel()),e.appendChild(t.getGui()),e.showingUnderlyingFloatingFilter=!0}))}return this.setupReadOnlyFloatingFilterElement(),t.AgPromise.resolve()},o.prototype.onColumnVisibleChanged=function(){this.setupUnderlyingFloatingFilterElement()},o.prototype.onColDefChanged=function(e){var t,o;if(e.column){var n=this.filterManager.getFloatingFilterCompDetails(e.column,this.params.showParentFilter);n&&(null===(o=null===(t=this.underlyingFloatingFilter)||void 0===t?void 0:t.onParamsUpdated)||void 0===o||o.call(t,n.params))}},o.prototype.onParentModelChanged=function(e,t){var o,n;this.showingUnderlyingFloatingFilter?null===(o=this.underlyingFloatingFilter)||void 0===o||o.onParentModelChanged(null===(n=this.parentFilterInstance.getSelectedFilter())||void 0===n?void 0:n.getModel(),t):this.updateDisplayedValue()},o.prototype.updateDisplayedValue=function(){if(this.parentFilterInstance&&this.eFloatingFilterText){var e=this.parentFilterInstance.getSelectedFilter();if(!e)return this.eFloatingFilterText.setValue(""),void this.eFloatingFilterText.setDisplayed(!1);if(this.eFloatingFilterText.setDisplayed(!0),e.getModelAsString){var t=e.getModel();this.eFloatingFilterText.setValue(null==t?"":e.getModelAsString(t))}else this.eFloatingFilterText.setValue("")}},o.prototype.onSelectedColumnChanged=function(){this.showingUnderlyingFloatingFilter||this.updateDisplayedValue()},o.prototype.onColumnRowGroupChanged=function(){this.showingUnderlyingFloatingFilter||this.updateDisplayedValue()},o.prototype.destroy=function(){e.prototype.destroy.call(this)},re([t.Autowired("columnModel")],o.prototype,"columnModel",void 0),re([t.Autowired("filterManager")],o.prototype,"filterManager",void 0),re([t.RefSelector("eFloatingFilter")],o.prototype,"eFloatingFilter",void 0),o}(t.Component),ae={version:"31.0.0",moduleName:t.ModuleNames.RowGroupingModule,beans:[i,$,c,m,A,E],agStackComponents:[{componentName:"AgGridHeaderDropZones",componentClass:Q}],userComponents:[{componentName:"agGroupColumnFilter",componentClass:oe},{componentName:"agGroupColumnFloatingFilter",componentClass:ie}],dependantModules:[o.EnterpriseCoreModule]},le=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){if("function"!=typeof o&&null!==o)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),se=function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},ue=function(e){function o(t){return e.call(this,t,"aggregation")||this}return le(o,e),o.prototype.passBeansUp=function(){e.prototype.setBeans.call(this,{gridOptionsService:this.gridOptionsService,eventService:this.eventService,context:this.getContext(),loggerFactory:this.loggerFactory,dragAndDropService:this.dragAndDropService});var o=this.localeService.getLocaleTextFunc(),n=o("valueColumnsEmptyMessage","Drag here to aggregate"),r=o("values","Values");e.prototype.init.call(this,{dragAndDropIcon:t.DragAndDropService.ICON_AGGREGATE,icon:t._.createIconNoSpan("valuePanel",this.gridOptionsService,null),emptyMessage:n,title:r}),this.addManagedListener(this.eventService,t.Events.EVENT_COLUMN_VALUE_CHANGED,this.refreshGui.bind(this))},o.prototype.getAriaLabel=function(){return this.localeService.getLocaleTextFunc()("ariaValuesDropZonePanelLabel","Values")},o.prototype.getTooltipParams=function(){var t=e.prototype.getTooltipParams.call(this);return t.location="valueColumnsList",t},o.prototype.getIconName=function(){return this.isPotentialDndColumns()?t.DragAndDropService.ICON_AGGREGATE:t.DragAndDropService.ICON_NOT_ALLOWED},o.prototype.isColumnDroppable=function(e){return!(this.gridOptionsService.get("functionsReadOnly")||!e.isPrimary())&&(e.isAllowValue()&&!e.isValueActive())},o.prototype.updateColumns=function(e){if(this.gridOptionsService.get("functionsPassive")){var o={type:t.Events.EVENT_COLUMN_VALUE_CHANGE_REQUEST,columns:e};this.eventService.dispatchEvent(o)}else this.columnModel.setValueColumns(e,"toolPanelUi")},o.prototype.getExistingColumns=function(){return this.columnModel.getValueColumns()},se([t.Autowired("columnModel")],o.prototype,"columnModel",void 0),se([t.Autowired("loggerFactory")],o.prototype,"loggerFactory",void 0),se([t.Autowired("dragAndDropService")],o.prototype,"dragAndDropService",void 0),se([t.PostConstruct],o.prototype,"passBeansUp",null),o}(k);exports.PivotDropZonePanel=z,exports.RowGroupDropZonePanel=W,exports.RowGroupingModule=ae,exports.ValuesDropZonePanel=ue;